<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mebel.by - –í—ã–≥–æ–¥–Ω—ã–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800;900&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; background-color: #fcfcfc; min-height: 100vh; } 
        .header-bg { background-color: #ffffff; box-shadow: 0 1px 3px 0 rgba(0,0,0,0.05); }
        .category-button {
            padding: 0.6rem 1.4rem; border: 2px solid #ffedd5; background-color: #ffffff;
            border-radius: 9999px; font-weight: 600; color: #4b5563; transition: all 0.3s ease;
            cursor: pointer; text-align: center; white-space: nowrap; box-shadow: 0 1px 2px rgba(0,0,0,0.05);
            font-size: 0.95rem; 
        }
        .category-button.active, .category-button:hover {
            border-color: #f97316; background-color: #f97316; color: #ffffff;
            box-shadow: 0 4px 6px -1px rgba(249,115,22,0.3); transform: translateY(-1px);
        }
        #category-filter::-webkit-scrollbar { display: none; }
        #category-filter { -ms-overflow-style: none; scrollbar-width: none; }
        .offer-card {
            background-color: white; border-radius: 1.25rem; overflow: hidden;
            box-shadow: 0 20px 25px -5px rgba(0,0,0,0.05),0 10px 10px -5px rgba(0,0,0,0.04);
            transition: transform 0.3s cubic-bezier(0.25,0.8,0.25,1); border: 1px solid #f3f4f6;
            cursor: pointer;
        }
        .offer-card:hover {
            transform: translateY(-6px);
            box-shadow: 0 25px 50px -12px rgba(0,0,0,0.1),0 15px 30px -5px rgba(0,0,0,0.08);
        }
        .card-button { background-color: #f97316; box-shadow: 0 4px 10px rgba(249,115,22,0.4); }
        .card-button:hover { background-color: #ea580c; }

                /* --- –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –Ω–∞–ª–æ–∂–µ–Ω–∏–π –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö --- */
        @media (max-width: 768px) {
        .product-layout {
            flex-direction: column !important;
            align-items: center !important;
            gap: 1.5rem !important;
        }
        .product-description,
        .product-pricing {
            width: 100% !important;
            text-align: center !important;
        }
        .product-pricing {
            margin-top: 1rem !important;
        }
        }

                #menu-toggle span {
        transition: all 0.3s ease;
        }
        #menu-toggle.active span:nth-child(1) {
        transform: translateY(8px) rotate(45deg);
        }
        #menu-toggle.active span:nth-child(2) {
        opacity: 0;
        }
        #menu-toggle.active span:nth-child(3) {
        transform: translateY(-8px) rotate(-45deg);
        }

    </style>
</head>
<body>

<!-- –í–µ—Ä—Ö–Ω—è—è –Ω–∞–≤–∏–≥–∞—Ü–∏—è -->
<!-- –í–µ—Ä—Ö–Ω—è—è –Ω–∞–≤–∏–≥–∞—Ü–∏—è -->
<header class="sticky top-0 header-bg z-20">
  <div class="max-w-4xl mx-auto px-4 py-4 flex justify-between items-center">
    <!-- –°–∫—Ä—ã—Ç–∞—è –∫–Ω–æ–ø–∫–∞ –∞–¥–º–∏–Ω–∞ -->
    <div id="hidden-admin-btn" style="width:20px;height:20px;opacity:0;cursor:pointer;margin-right:8px;"></div>

    <h1 class="text-3xl font-black text-gray-900 tracking-tight cursor-pointer" onclick="window.scrollTo(0, 0)">Mebel.by</h1>

    <div class="flex items-center space-x-4">
      <!-- –ì–æ—Ä–æ–¥ -->
      <div class="flex items-center space-x-2 text-sm cursor-pointer p-2 rounded-lg hover:bg-gray-50 transition">
        <span id="current-city" class="font-bold text-gray-700">–ì–æ–º–µ–ª—å</span>
        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-gray-500" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
        </svg>
      </div>

      <!-- –ò–∑–±—Ä–∞–Ω–Ω–æ–µ -->
      <a href="favorites.html"
         class="group relative flex items-center justify-center w-12 h-12 rounded-full hover:bg-orange-100 transition"
         title="–ò–∑–±—Ä–∞–Ω–Ω–æ–µ">
        <svg xmlns="http://www.w3.org/2000/svg" 
             fill="none" 
             viewBox="0 0 24 24" 
             stroke-width="2" 
             stroke="currentColor" 
             class="w-6 h-6 text-gray-700 group-hover:text-orange-500 transition">
          <path stroke-linecap="round" stroke-linejoin="round" d="M12 21C12 21 6 16 4 11C2 6 4 2 8 3C10 4 12 6 12 6C12 6 14 4 16 3C20 2 22 6 20 11C18 16 12 21 12 21Z" />
        </svg>
        <span class="sr-only">–ò–∑–±—Ä–∞–Ω–Ω–æ–µ</span>
      </a>

      <!-- –ö–æ—Ä–∑–∏–Ω–∞ (–Ω–æ–≤—ã–π –∑–Ω–∞—á–æ–∫) -->
      <a href="order.html" 
         class="group relative flex items-center justify-center w-12 h-12 rounded-full hover:bg-orange-100 transition"
         title="–ö–æ—Ä–∑–∏–Ω–∞">
        <svg xmlns="http://www.w3.org/2000/svg"
             fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor"
             class="w-6 h-6 text-gray-700 group-hover:text-orange-500 transition">
          <path stroke-linecap="round" stroke-linejoin="round"
                d="M6 7V6a3 3 0 013-3h6a3 3 0 013 3v1m2 0a1 1 0 011 1v12a2 2 0 01-2 2H5a2 2 0 01-2-2V8a1 1 0 011-1h16z" />
        </svg>
        <span class="sr-only">–ö–æ—Ä–∑–∏–Ω–∞</span>
      </a>
    </div>
  </div>
</header>

<!-- –ö–Ω–æ–ø–∫–∞ –±—É—Ä–≥–µ—Ä -->
<button id="menu-toggle" class="flex flex-col justify-between w-7 h-5 focus:outline-none ml-2 hover:scale-110 transition-transform">
  <span class="block w-full h-0.5 bg-gray-800"></span>
  <span class="block w-full h-0.5 bg-gray-800"></span>
  <span class="block w-full h-0.5 bg-gray-800"></span>
</button>

<!-- –í—ã–µ–∑–∂–∞—é—â–µ–µ –º–µ–Ω—é -->
<div id="side-menu" class="fixed inset-y-0 left-0 w-64 bg-white shadow-2xl transform -translate-x-full transition-transform duration-300 z-40 flex flex-col">
  <div class="flex items-center justify-between p-4 border-b">
    <h2 id="side-menu-title" class="text-xl font-bold text-gray-800">–ú–µ–Ω—é</h2>
    <button id="side-menu-close" class="text-gray-500 hover:text-gray-700 text-2xl leading-none">&times;</button>
  </div>
  
  <!-- –û—Å–Ω–æ–≤–Ω–æ–π —Å–ø–∏—Å–æ–∫ -->
  <div id="side-menu-content" class="flex-1 overflow-y-auto p-4 space-y-3">
    <!-- –ó–¥–µ—Å—å JS –ø–æ–¥—Å—Ç–∞–≤–∏—Ç –∫–æ–Ω—Ç–µ–Ω—Ç -->
  </div>
</div>

<!-- –ü–æ–ª—É–ø—Ä–æ–∑—Ä–∞—á–Ω—ã–π —Ñ–æ–Ω -->
<div id="menu-overlay" class="fixed inset-0 bg-black/40 hidden z-30"></div>

    <!-- –û–°–ù–û–í–ù–û–ô –ö–û–ù–¢–ï–ô–ù–ï–† –î–õ–Ø –°–ü–ò–°–ö–ê –¢–û–í–ê–†–û–í (–ï–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω—ã–π –≤–∏–¥–∏–º—ã–π –≤–∏–¥) -->
    <div id="main-view-container">
        <main class="max-w-4xl mx-auto px-4 mt-6">
            <!-- –ë–∞–Ω–Ω–µ—Ä –ö–∞—Ä—É—Å–µ–ª—å -->
            <div id="carousel-banner" class="relative rounded-3xl overflow-hidden shadow-2xl mb-8 h-64 md:h-96 bg-gray-200">
                <!-- –°–ª–∞–π–¥—ã –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª—è—Ç—å—Å—è —á–µ—Ä–µ–∑ JS -->
                <div id="carousel-slides" class="h-full w-full relative"></div>

                <!-- –ù–∞–≤–∏–≥–∞—Ü–∏–æ–Ω–Ω—ã–µ –∫–Ω–æ–ø–∫–∏ -->
                <button id="carousel-prev" class="absolute left-3 top-1/2 transform -translate-y-1/2 bg-black/20 text-white p-2 rounded-full hover:bg-black/40 transition z-20">
                    &#10094;
                </button>
                <button id="carousel-next" class="absolute right-3 top-1/2 transform -translate-y-1/2 bg-black/20 text-white p-2 rounded-full hover:bg-black/40 transition z-20">
                    &#10095;
                </button>

                <!-- –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã -->
                <div id="carousel-indicators" class="absolute bottom-3 left-1/2 transform -translate-x-1/2 flex space-x-2 z-20"></div>
            </div>


            <!-- –ü–æ–∏—Å–∫ -->
            <div class="relative mb-8">
                <input type="text" id="search-input" placeholder="–ü–æ–∏—Å–∫: –¥–∏–≤–∞–Ω, —à–∫–∞—Ñ, –∫—É—Ö–Ω—è..." class="w-full py-3.5 pl-14 pr-6 text-lg border-2 border-gray-200 rounded-full focus:ring-orange-500 focus:border-orange-500 transition duration-200" />
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 absolute left-5 top-1/2 transform -translate-y-1/2 text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
                </svg>
            </div>

            <!-- –ö–∞—Ç–µ–≥–æ—Ä–∏–∏ -->
            <h3 class="text-2xl font-bold text-gray-800 mb-4">–ö–∞—Ç–∞–ª–æ–≥</h3>
            <div id="category-filter" class="flex flex-nowrap overflow-x-auto space-x-3 pb-4 scrollbar-hide">
                <!-- –ö–∞—Ç–µ–≥–æ—Ä–∏–∏ –±—É–¥—É—Ç –∑–∞–≥—Ä—É–∂–µ–Ω—ã —Å—é–¥–∞ JavaScript'–æ–º -->
            </div>

            <!-- –ü—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è -->
            <h3 class="text-2xl font-bold text-gray-800 my-6">–í—ã–≥–æ–¥–Ω—ã–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è</h3>
            <div id="offers-list" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-8">
                <div id="no-offers" class="col-span-full text-center text-gray-500 hidden p-8">–ü—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–π –ø–æ –≤–∞—à–µ–º—É –∑–∞–ø—Ä–æ—Å—É –Ω–µ –Ω–∞–π–¥–µ–Ω–æ.</div>
                <!-- –ö–∞—Ä—Ç–æ—á–∫–∏ —Ç–æ–≤–∞—Ä–æ–≤ –±—É–¥—É—Ç –∑–∞–≥—Ä—É–∂–µ–Ω—ã —Å—é–¥–∞ JavaScript'–æ–º -->
            </div>
        </main>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –∞–¥–º–∏–Ω–∞ -->
    <div id="admin-modal" class="fixed inset-0 bg-black/50 flex items-center justify-center hidden z-50">
        <div class="bg-white rounded-2xl p-6 w-80 relative">
            <h3 class="text-xl font-bold mb-4">–í—Ö–æ–¥ –ê–¥–º–∏–Ω–∞</h3>
            <!-- –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è —Å–æ–æ–±—â–µ–Ω–∏–π –æ–± –æ—à–∏–±–∫–∞—Ö -->
            <div id="admin-message" class="text-sm text-center font-medium my-2 hidden p-2 rounded"></div>
            
            <input type="email" id="admin-email" placeholder="Email" class="w-full mb-3 p-2 border rounded-lg focus:ring-orange-500 focus:border-orange-500 transition" />
            <input type="password" id="admin-password" placeholder="–ü–∞—Ä–æ–ª—å" class="w-full mb-3 p-2 border rounded-lg focus:ring-orange-500 focus:border-orange-500 transition" />
            <div class="flex justify-between">
                <button id="admin-register" class="bg-green-500 text-white px-4 py-2 rounded-lg hover:bg-green-600 transition">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</button>
                <button id="admin-login" class="bg-orange-500 text-white px-4 py-2 rounded-lg hover:bg-orange-600 transition">–í–æ–π—Ç–∏</button>
            </div>
            <button id="admin-close" class="absolute top-3 right-3 text-2xl text-gray-400 hover:text-gray-600 leading-none">&times;</button>
        </div>
    </div>
    
    <!-- –ö–∞—Å—Ç–æ–º–Ω–æ–µ –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Å–æ–æ–±—â–µ–Ω–∏–π -->
    <div id="custom-message-modal" class="fixed inset-0 bg-black/50 flex items-center justify-center hidden z-50">
        <div class="bg-white rounded-2xl p-6 max-w-sm w-full relative text-center shadow-xl">
            <p id="custom-message-text" class="text-gray-700 mb-4"></p>
            <button id="custom-message-close" class="bg-orange-500 text-white px-6 py-2 rounded-lg hover:bg-orange-600 transition">–û–ö</button>
        </div>
    </div>

    <!-- JavaScript –ª–æ–≥–∏–∫–∞ -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, signInWithCustomToken, signInWithEmailAndPassword, createUserWithEmailAndPassword } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, collection, onSnapshot, query, setLogLevel } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
        // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ä–µ–∂–∏–º –æ—Ç–ª–∞–¥–∫–∏ –¥–ª—è Firestore
        setLogLevel('Debug');

        // --- FIREBASE CONFIGURATION & AUTH VARIABLES ---
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
        const initialAuthToken = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : null;
        
        // –ü—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–Ω–∞—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –≤ –∫–∞—á–µ—Å—Ç–≤–µ —Ä–µ–∑–µ—Ä–≤–Ω–æ–π
        const USER_FALLBACK_CONFIG = {
            apiKey: "AIzaSyA-LeQHKV4NfJrTKQCGjG-VQGhfWxtPk70",
            authDomain: "vsemmebel-90d48.firebaseapp.com",
            projectId: "vsemmebel-90d48",
            storageBucket: "vsemmebel-90d48.firebasestorage.app",
            messagingSenderId: "958123504041",
            appId: "1:958123504041:web:1f14f4561d6bb6628494b8"
        };
        
        let firebaseConfig = USER_FALLBACK_CONFIG; // –ù–∞—á–∏–Ω–∞–µ–º —Å —Ä–µ–∑–µ—Ä–≤–Ω–æ–π –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

        try {
            // –ü–æ–ø—ã—Ç–∫–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –∏–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π —Ö–æ—Å—Ç–∏–Ω–≥–∞
            if (typeof __firebase_config !== 'undefined' && __firebase_config) {
                const envConfig = JSON.parse(__firebase_config);
                if (typeof envConfig === 'object' && envConfig !== null && envConfig.projectId) {
                    firebaseConfig = envConfig;
                }
            }
        } catch (e) {
            console.warn("–ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ: –ù–µ —É–¥–∞–ª–æ—Å—å —Ä–∞—Å–ø–∞—Ä—Å–∏—Ç—å JSON –∏–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π —Ö–æ—Å—Ç–∏–Ω–≥–∞. –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è.", e);
        }

        let app = null;
        let db = null;
        let auth = null;
        let userId = null;
        const productCollectionPath = `artifacts/${appId}/public/data/offers`;

        // 1. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Firebase
        function initializeFirebase() {
            if (!firebaseConfig || !firebaseConfig.projectId) {
                console.error("–ö–†–ò–¢–ò–ß–ï–°–ö–ê–Ø –û–®–ò–ë–ö–ê: –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Firebase –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞.");
                return;
            }

            try {
                app = initializeApp(firebaseConfig);
                db = getFirestore(app);
                auth = getAuth(app); 
                console.log("Firebase —É—Å–ø–µ—à–Ω–æ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω.");
                loadCarouselFromFirestore();
            } catch (e) {
                console.error("–ö–†–ò–¢–ò–ß–ï–°–ö–ê–Ø –û–®–ò–ë–ö–ê: –û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ Firebase.", e);
                db = null; auth = null; // –û–±–µ—Å–ø–µ—á–∏–≤–∞–µ–º, —á—Ç–æ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ null –≤ —Å–ª—É—á–∞–µ –æ—à–∏–±–∫–∏
            }
        }

        // 2. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ (–≤—Ö–æ–¥ –∞–Ω–æ–Ω–∏–º–Ω–æ –∏–ª–∏ –ø–æ —Ç–æ–∫–µ–Ω—É)
        async function initializeAuth() {
            if (!auth) {
                // –ï—Å–ª–∏ Auth –Ω–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω, –∏—Å–ø–æ–ª—å–∑—É–µ–º —Ä–∞–Ω–¥–æ–º–Ω—ã–π ID
                userId = crypto.randomUUID();
                return; 
            }
            
            try {
                if (initialAuthToken) {
                    await signInWithCustomToken(auth, initialAuthToken);
                } else {
                    await signInAnonymously(auth); 
                }
                userId = auth.currentUser?.uid || crypto.randomUUID();
                console.log("–ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è —É—Å–ø–µ—à–Ω–∞. UID:", userId);
                // –ó–∞–ø—É—Å–∫ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö –ø–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–π –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
                setupRealtimeOffersListener();
            } catch (error) {
                console.error("–û—à–∏–±–∫–∞ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ Firebase:", error);
                showCustomMessage("–û—à–∏–±–∫–∞ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω—Å–æ–ª—å –¥–ª—è –¥–µ—Ç–∞–ª–µ–π.");
            }
        }
        
        // --- Custom Message Modal (–ó–∞–º–µ–Ω–∞ alert/confirm) ---
        const customModal = document.getElementById('custom-message-modal');
        const customMessageText = document.getElementById('custom-message-text');
        const customMessageCloseBtn = document.getElementById('custom-message-close');
        
        function closeCustomMessage() {
            customModal.classList.add('hidden');
        }

        function showCustomMessage(message) {
            customMessageText.textContent = message;
            customModal.classList.remove('hidden');
        }

        customMessageCloseBtn.onclick = closeCustomMessage;


        // --- Admin Login Modal Logic ---
        const adminModal = document.getElementById('admin-modal');
        const adminCloseBtn = document.getElementById('admin-close');
        const adminEmailInput = document.getElementById('admin-email');
        const adminPasswordInput = document.getElementById('admin-password');
        const adminLogin = document.getElementById('admin-login');
        const adminRegister = document.getElementById('admin-register');
        const adminMessageDiv = document.getElementById('admin-message');
        
        // –ü—Ä–∏–º–µ—á–∞–Ω–∏–µ: –ø—Ä–µ–¥–ø–æ–ª–∞–≥–∞–µ—Ç—Å—è, —á—Ç–æ admin.html —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –≤ –∫–æ—Ä–Ω–µ–≤–æ–º –∫–∞—Ç–∞–ª–æ–≥–µ.
        const ADMIN_REDIRECT_URL = 'admin.html'; 

        adminCloseBtn.onclick = () => adminModal.classList.add('hidden');

        function showAdminMessage(message, isError = false) {
            adminMessageDiv.textContent = message;
            adminMessageDiv.classList.remove('hidden');
            if (isError) {
                adminMessageDiv.className = 'text-sm text-center font-medium my-2 p-2 rounded bg-red-100 text-red-700';
            } else {
                adminMessageDiv.className = 'text-sm text-center font-medium my-2 p-2 rounded bg-green-100 text-green-700';
            }
        }

        // --- –õ–û–ì–ò–ö–ê –ê–î–ú–ò–ù–ê: –í–•–û–î –ß–ï–†–ï–ó EMAIL/–ü–ê–†–û–õ–¨ ---
        adminLogin.onclick = async () => {
            const email = adminEmailInput.value;
            const password = adminPasswordInput.value;
            if (!email || !password) return showAdminMessage('–í–≤–µ–¥–∏—Ç–µ email –∏ –ø–∞—Ä–æ–ª—å', true);
            
            if (!auth) {
                console.error("–û—à–∏–±–∫–∞: Firebase Auth –Ω–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –æ–±–Ω–æ–≤–∏—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É.");
                return showAdminMessage('–û—à–∏–±–∫–∞: Firebase Auth –Ω–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω—Å–æ–ª—å.', true);
            }

            try {
                await signInWithEmailAndPassword(auth, email, password);
                console.log("–ê–¥–º–∏–Ω –≤–æ—à–µ–ª. –ü–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –Ω–∞ admin.html");
                window.location.href = ADMIN_REDIRECT_URL;
                
            } catch (error) {
                console.error("–û—à–∏–±–∫–∞ –≤—Ö–æ–¥–∞ –∞–¥–º–∏–Ω–∞:", error);
                let errorMessage = '–û—à–∏–±–∫–∞ –≤—Ö–æ–¥–∞. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –¥–∞–Ω–Ω—ã–µ.';
                if (error.code === 'auth/user-not-found') {
                    errorMessage = '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å —Ç–∞–∫–∏–º email –Ω–µ –Ω–∞–π–¥–µ–Ω.';
                } else if (error.code === 'auth/wrong-password') {
                    errorMessage = '–ù–µ–≤–µ—Ä–Ω—ã–π –ø–∞—Ä–æ–ª—å.';
                }
                showAdminMessage(errorMessage, true);
            }
        };

        // --- –õ–û–ì–ò–ö–ê –ê–î–ú–ò–ù–ê: –†–ï–ì–ò–°–¢–†–ê–¶–ò–Ø –ß–ï–†–ï–ó EMAIL/–ü–ê–†–û–õ–¨ ---
        adminRegister.onclick = async () => {
            const email = adminEmailInput.value;
            const password = adminPasswordInput.value;
            if (!email || !password) return showAdminMessage('–í–≤–µ–¥–∏—Ç–µ email –∏ –ø–∞—Ä–æ–ª—å', true);
            
            if (!auth) {
                console.error("–û—à–∏–±–∫–∞: Firebase Auth –Ω–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –æ–±–Ω–æ–≤–∏—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É.");
                return showAdminMessage('–û—à–∏–±–∫–∞: Firebase Auth –Ω–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω—Å–æ–ª—å.', true);
            }

            try {
                await createUserWithEmailAndPassword(auth, email, password);
                console.log("–ê–¥–º–∏–Ω –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω. –ü–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –Ω–∞ admin.html");
                window.location.href = ADMIN_REDIRECT_URL;
                
            } catch (error) {
                console.error("–û—à–∏–±–∫–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –∞–¥–º–∏–Ω–∞:", error);
                let errorMessage = '–û—à–∏–±–∫–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏.';
                if (error.code === 'auth/email-already-in-use') {
                    errorMessage = '–≠—Ç–æ—Ç email —É–∂–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è.';
                } else if (error.code === 'auth/weak-password') {
                    errorMessage = '–ü–∞—Ä–æ–ª—å –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –Ω–µ –º–µ–Ω–µ–µ 6 —Å–∏–º–≤–æ–ª–æ–≤.';
                }
                showAdminMessage(errorMessage, true);
            }
        };

        // --- Carousel Logic ---
let carouselData = []; // –æ–±—ä–µ–∫—Ç—ã: {imageUrl, title, subtitle, buttonText, buttonLink, order}
let currentSlide = 0;
let carouselInterval = null;

const slidesContainer = document.getElementById('carousel-slides');
const indicatorsContainer = document.getElementById('carousel-indicators');
const prevBtn = document.getElementById('carousel-prev');
const nextBtn = document.getElementById('carousel-next');

// –§—É–Ω–∫—Ü–∏—è —Ä–µ–Ω–¥–µ—Ä–∞ –∫–∞—Ä—É—Å–µ–ª–∏ –±–µ–∑ –∑–∞—Ç–µ–º–Ω–µ–Ω–∏—è
function renderCarousel() {
    slidesContainer.innerHTML = '';
    indicatorsContainer.innerHTML = '';

    carouselData.forEach((slide, index) => {
        // –°–æ–∑–¥–∞–Ω–∏–µ —Å–ª–∞–π–¥–æ–≤
        const slideDiv = document.createElement('div');
        slideDiv.className = `absolute inset-0 transition-opacity duration-700 ease-in-out ${index === currentSlide ? 'opacity-100 z-10' : 'opacity-0 z-0'}`;

        // –¢–æ–ª—å–∫–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –±–µ–∑ –∑–∞—Ç–µ–º–Ω–µ–Ω–∏—è
        slideDiv.innerHTML = `
            <img src="${slide.url}" alt="${slide.title || ''}" class="w-full h-full object-cover">
        `;
        slidesContainer.appendChild(slideDiv);

        // –°–æ–∑–¥–∞–Ω–∏–µ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–æ–≤
        const indicator = document.createElement('button');
        indicator.className = `w-3 h-3 rounded-full bg-white/50 hover:bg-white transition ${index === currentSlide ? 'bg-white' : ''}`;
        indicator.onclick = () => {
            currentSlide = index;
            updateCarousel();
            startCarouselAutoplay(); // —Å–±—Ä–æ—Å —Ç–∞–π–º–µ—Ä–∞ –ø—Ä–∏ —Ä—É—á–Ω–æ–º –∫–ª–∏–∫–µ
        };
        indicatorsContainer.appendChild(indicator);
    });
}

// –§—É–Ω–∫—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –≤–∏–¥–∏–º–æ–≥–æ —Å–ª–∞–π–¥–∞
function updateCarousel() {
    const slides = slidesContainer.children;
    const indicators = indicatorsContainer.children;
    for (let i = 0; i < slides.length; i++) {
        slides[i].classList.toggle('opacity-100', i === currentSlide);
        slides[i].classList.toggle('opacity-0', i !== currentSlide);
        slides[i].classList.toggle('z-10', i === currentSlide);
        slides[i].classList.toggle('z-0', i !== currentSlide);
        indicators[i].classList.toggle('bg-white', i === currentSlide);
        indicators[i].classList.toggle('bg-white/50', i !== currentSlide);
    }
}

// –ê–≤—Ç–æ–ø–µ—Ä–µ–ª–∏—Å—Ç—ã–≤–∞–Ω–∏–µ –∫–∞–∂–¥—ã–µ 5 —Å–µ–∫—É–Ω–¥
function startCarouselAutoplay() {
    if (carouselInterval) clearInterval(carouselInterval);
    if (carouselData.length === 0) return; // –µ—Å–ª–∏ —Å–ª–∞–π–¥–æ–≤ –Ω–µ—Ç
    carouselInterval = setInterval(() => {
        currentSlide = (currentSlide + 1) % carouselData.length;
        updateCarousel();
    }, 5000);
}

// –ö–Ω–æ–ø–∫–∏ –≤—Ä—É—á–Ω—É—é
prevBtn.onclick = () => {
    currentSlide = (currentSlide - 1 + carouselData.length) % carouselData.length;
    updateCarousel();
    startCarouselAutoplay(); // —Å–±—Ä–æ—Å —Ç–∞–π–º–µ—Ä–∞
};

nextBtn.onclick = () => {
    currentSlide = (currentSlide + 1) % carouselData.length;
    updateCarousel();
    startCarouselAutoplay(); // —Å–±—Ä–æ—Å —Ç–∞–π–º–µ—Ä–∞
};

// –ó–∞–≥—Ä—É–∑–∫–∞ –∫–∞—Ä—É—Å–µ–ª–∏ –∏–∑ Firestore
function loadCarouselFromFirestore() {
    if (!db) return;

    const carouselRef = collection(db, `artifacts/${appId}/public/data/carousel`);
    onSnapshot(carouselRef, snapshot => {
        carouselData = [];
        snapshot.forEach(doc => {
            carouselData.push({ id: doc.id, ...doc.data() });
        });

        // –°–æ—Ä—Ç–∏—Ä—É–µ–º –ø–æ –ø–æ—Ä—è–¥–∫—É –∏ –æ–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º –º–∞–∫—Å–∏–º—É–º 5 —Å–ª–∞–π–¥–æ–≤
        carouselData.sort((a, b) => (a.order || 0) - (b.order || 0));
        if (carouselData.length > 5) carouselData = carouselData.slice(0,5);

        currentSlide = 0;
        renderCarousel();
        startCarouselAutoplay();
    });
}

// –ó–∞–ø—É—Å–∫ –ø–æ—Å–ª–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ Firebase
        // --- MAIN APPLICATION LOGIC ---

        // –ö–∞—Ç–µ–≥–æ—Ä–∏–∏ (–∑–∞–≥–ª—É—à–∫–∞)
        const CATEGORIES = ["–í—Å–µ —Ç–æ–≤–∞—Ä—ã", "–î–∏–≤–∞–Ω—ã", "–ö—Ä–æ–≤–∞—Ç–∏", "–®–∫–∞—Ñ—ã", "–°—Ç–æ–ª—ã –∏ –°—Ç—É–ª—å—è", "–ö—É—Ö–Ω–∏"];

        let currentCategory = "–í—Å–µ —Ç–æ–≤–∞—Ä—ã";
        let allOffers = []; // –ë—É–¥–µ—Ç —Ö—Ä–∞–Ω–∏—Ç—å –í–°–ï –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã–µ —Ç–æ–≤–∞—Ä—ã (–ø–æ–ª–Ω—ã–µ –æ–±—ä–µ–∫—Ç—ã)
        let searchTerm = "";

        const categoryFilterDiv = document.getElementById('category-filter');
        const offersListDiv = document.getElementById('offers-list');
        const searchInput = document.getElementById('search-input');
        const noOffersDiv = document.getElementById('no-offers');


        // --- Data Loading and Filtering ---

        // 3. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ —Å–ª—É—à–∞—Ç–µ–ª—è Firestore –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö
        function setupRealtimeOffersListener() {
            if (!db) return;

            const offersRef = collection(db, productCollectionPath);
            const q = query(offersRef);

            onSnapshot(q, (snapshot) => {
                const fetchedOffers = [];
                snapshot.forEach(doc => {
                    // –°–æ—Ö—Ä–∞–Ω—è–µ–º –í–ï–°–¨ –æ–±—ä–µ–∫—Ç –¥–∞–Ω–Ω—ã—Ö
                    fetchedOffers.push({ id: doc.id, ...doc.data() });
                });
                
                allOffers = fetchedOffers;
                // *** –î–û–ë–ê–í–õ–ï–ù–û –õ–û–ì–ò–†–û–í–ê–ù–ò–ï: –ü—Ä–æ–≤–µ—Ä—è–µ–º, —Å–∫–æ–ª—å–∫–æ —Ç–æ–≤–∞—Ä–æ–≤ –ø—Ä–∏—à–ª–æ –∏–∑ –±–∞–∑—ã ***
                console.log(`[Firestore] –ó–∞–≥—Ä—É–∂–µ–Ω–æ ${allOffers.length} —Ç–æ–≤–∞—Ä–æ–≤. (0 = –Ω–µ—Ç —Ç–æ–≤–∞—Ä–æ–≤)`);
                // –ü–µ—Ä–µ—Ä–∏—Å–æ–≤—ã–≤–∞–µ–º –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –Ω–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö
                renderOffers(); 
            }, (error) => {
                console.error("–û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è —Ç–æ–≤–∞—Ä–æ–≤ –∏–∑ Firestore:", error);
                showCustomMessage("–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å —Ç–æ–≤–∞—Ä—ã. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω—Å–æ–ª—å.");
            });
        }

        // --- Render Functions ---

        function renderCategories() {
            categoryFilterDiv.innerHTML = '';
            CATEGORIES.forEach(category => {
                const button = document.createElement('button');
                button.className = `category-button ${category === currentCategory ? 'active' : ''}`;
                button.textContent = category;
                button.onclick = () => {
                    setActiveCategory(category);
                };
                categoryFilterDiv.appendChild(button);
            });
        }

        function setActiveCategory(category) {
            currentCategory = category;
            renderCategories(); // –û–±–Ω–æ–≤–∏—Ç—å —Å—Ç–∏–ª–∏ –∫–Ω–æ–ø–æ–∫
            renderOffers(); ¬† ¬†// –ü—Ä–∏–º–µ–Ω–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä
        }

        function renderOffers() {
            // *** –î–û–ë–ê–í–õ–ï–ù–û –õ–û–ì–ò–†–û–í–ê–ù–ò–ï: –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –æ—á–∏—Å—Ç–∫–∞ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç ***
            console.log(`[Render] –û—á–∏—Å—Ç–∫–∞ —Å–ø–∏—Å–∫–∞ —Ç–æ–≤–∞—Ä–æ–≤. –¢–æ–≤–∞—Ä–æ–≤ –∫ —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥—É –ø–æ—Å–ª–µ —Ñ–∏–ª—å—Ç—Ä–∞: ${allOffers.length}`);

            offersListDiv.innerHTML = '';
            
            // 1. –§–∏–ª—å—Ç—Ä –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
            const filteredByCategory = currentCategory === "–í—Å–µ —Ç–æ–≤–∞—Ä—ã"
                ? allOffers
                : allOffers.filter(offer => offer.category === currentCategory);

            // 2. –§–∏–ª—å—Ç—Ä –ø–æ –ø–æ–∏—Å–∫–æ–≤–æ–º—É –∑–∞–ø—Ä–æ—Å—É
            const filteredBySearch = searchTerm.trim().toLowerCase();
            const finalOffers = filteredByCategory.filter(offer => 
                offer.title?.toLowerCase().includes(filteredBySearch) || 
                offer.category?.toLowerCase().includes(filteredBySearch)
            );

            if (finalOffers.length === 0) {
                noOffersDiv.classList.remove('hidden');
                // –í–∞–∂–Ω–æ: –≤—Å—Ç–∞–≤–ª—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ "–ù–µ—Ç —Ç–æ–≤–∞—Ä–æ–≤" –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä offersListDiv
                offersListDiv.appendChild(noOffersDiv);
                return;
            }
            noOffersDiv.classList.add('hidden');

            // 3. –†–µ–Ω–¥–µ—Ä–∏–Ω–≥ –∫–∞—Ä—Ç–æ—á–µ–∫
            finalOffers.forEach(offer => {
                // –ò—â–µ–º –ø–µ—Ä–≤—É—é –∞–∫—Ç–∏–≤–Ω—É—é –∫–æ–º–±–∏–Ω–∞—Ü–∏—é –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Ü–µ–Ω—ã
                // *** –ë–´–õ–ê –î–û–ë–ê–í–õ–ï–ù–ê –ü–†–û–í–ï–†–ö–ê –ù–ê –°–£–©–ï–°–¢–í–û–í–ê–ù–ò–ï offer.combinations ***
                const activeCombo = offer.combinations?.find(c => c.isActive) || offer.combinations?.[0] || { price: 0 }; 
                const originalPrice = activeCombo.price || 0;
                const finalPrice = originalPrice * (1 - (offer.discount || 0) / 100);
                const imageUrl = offer.images?.[0] || `https://placehold.co/400x300/f3f4f6/4b5563?text=${encodeURIComponent(offer.title || '–ù–µ—Ç –§–æ—Ç–æ')}`;

                const card = document.createElement('div');
                card.className = 'offer-card flex flex-col cursor-pointer';
                card.setAttribute('data-offer-id', offer.id);
                
                // *** –ò–ó–ú–ï–ù–ï–ù–ò–ï: –¢–µ–ø–µ—Ä—å –∫–ª–∏–∫ –Ω–∞ –∫–∞—Ä—Ç–æ—á–∫—É –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è–µ—Ç –Ω–∞ purchase.html ***
                card.onclick = () => showProductDetails(offer.id);

                const priceDisplay = offer.discount > 0 ? 
                    `
                    <p class="text-xl font-extrabold text-red-600">${Math.round(finalPrice)} BYN</p>
                    <p class="text-sm text-gray-400 line-through">${Math.round(originalPrice)} BYN</p>
                    ` : 
                    `<p class="text-xl font-extrabold text-gray-900">${Math.round(finalPrice)} BYN</p>`;

                card.innerHTML = `
                    <div class="h-48 overflow-hidden relative">
                        <!-- –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å –∑–∞–≥–ª—É—à–∫–æ–π -->
                        <img 
                            src="${imageUrl}" 
                            alt="${offer.title}" 
                            class="w-full h-full object-cover transition duration-500 ease-in-out hover:scale-105"
                            onerror="this.onerror=null; this.src='https://placehold.co/400x300/f3f4f6/4b5563?text=–ù–µ—Ç+–§–æ—Ç–æ';"
                        >
                        ${offer.discount > 0 ? `<div class="absolute top-3 left-3 bg-red-500 text-white text-xs font-bold px-3 py-1 rounded-full shadow-lg">- ${offer.discount}%</div>` : ''}
                    </div>
                    <div class="p-5 flex flex-col flex-grow">
                        <p class="text-sm font-semibold text-orange-600 mb-1">${offer.category || '–ü—Ä–æ—á–µ–µ'}</p>
                        <h4 class="text-lg font-bold text-gray-900 mb-3 flex-grow">${offer.title || '–¢–æ–≤–∞—Ä –±–µ–∑ –Ω–∞–∑–≤–∞–Ω–∏—è'}</h4>
                        <div class="flex items-end justify-between mt-auto">
                            <div class="flex items-center space-x-2">
                                ${priceDisplay}
                            </div>
                            <!-- –ö–Ω–æ–ø–∫–∞ "–ó–∞–∫–∞–∑–∞—Ç—å" —Ç–µ–ø–µ—Ä—å –≤—ã–∑—ã–≤–∞–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ, —á—Ç–æ–±—ã –Ω–µ –º–µ—à–∞—Ç—å –∫–ª–∏–∫—É –ø–æ –∫–∞—Ä—Ç–æ—á–∫–µ -->
                            <button onclick="event.stopPropagation(); window.showCustomMessage('–í—ã –¥–æ–±–∞–≤–∏–ª–∏ ${offer.title || '—ç—Ç–æ—Ç —Ç–æ–≤–∞—Ä'} –≤ –∫–æ—Ä–∑–∏–Ω—É (–∏–º–∏—Ç–∞—Ü–∏—è)!')" class="card-button text-white text-sm font-bold py-2 px-4 rounded-full transition">
                                –ó–∞–∫–∞–∑–∞—Ç—å
                            </button>
                        </div>
                    </div>
                `;
                offersListDiv.appendChild(card);
            });
        }
        
        // --- Product Detail Page (PDP) Logic ---

        // *** –ò–ó–ú–ï–ù–ï–ù–ò–ï: –£–ü–†–û–©–ï–ù–ù–ê–Ø –§–£–ù–ö–¶–ò–Ø –î–õ–Ø –†–ï–î–ò–†–ï–ö–¢–ê ***
        function showProductDetails(id) {
            // –ü–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è–µ–º –Ω–∞ –Ω–æ–≤—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É, –ø–µ—Ä–µ–¥–∞–≤–∞—è ID —Ç–æ–≤–∞—Ä–∞
            window.location.href = `product.html?id=${id}`;
        }
        
        // –ì–ª–æ–±–∞–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∏–∑ HTML
        window.showCustomMessage = showCustomMessage;


        // --- Event Listeners ---

        searchInput.addEventListener('input', (e) => {
            searchTerm = e.target.value;
            renderOffers();
        });


        // --- Initialization ---

        // 1. –ó–∞–ø—É—Å–∫–∞–µ–º –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—é Firebase –∏ Auth –ù–ï–ú–ï–î–õ–ï–ù–ù–û
        initializeFirebase();
        initializeAuth(); // –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è -> setupRealtimeOffersListener

        // 2. DOM-–∑–∞–≤–∏—Å–∏–º—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –∑–∞–ø—É—Å–∫–∞–µ–º –ø–æ—Å–ª–µ –ø–æ–ª–Ω–æ–π –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        window.onload = () => {
            renderCategories(); // –†–µ–Ω–¥–µ—Ä–∏–º –∫–Ω–æ–ø–∫–∏ –∫–∞—Ç–µ–≥–æ—Ä–∏–π
            // –†–µ–Ω–¥–µ—Ä–∏–Ω–≥ —Ç–æ–≤–∞—Ä–æ–≤ –±—É–¥–µ—Ç –≤—ã–∑–≤–∞–Ω –ø–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–π –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ –≤ initializeAuth -> setupRealtimeOffersListener
        };
            // --- –°–µ–∫—Ä–µ—Ç–Ω–∞—è –∫–Ω–æ–ø–∫–∞ –∞–¥–º–∏–Ω–∞ —Å–ª–µ–≤–∞ –æ—Ç –ª–æ–≥–æ—Ç–∏–ø–∞ ---
        const hiddenAdminBtn = document.getElementById('hidden-admin-btn');
        hiddenAdminBtn.onclick = () => {
            const password = prompt("–í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å –¥–ª—è –∞–¥–º–∏–Ω–∞:");
            if (password === "1234") {  // <-- –∑–¥–µ—Å—å —Ç–≤–æ–π –ø–∞—Ä–æ–ª—å
                adminModal.classList.remove('hidden'); // –æ—Ç–∫—Ä—ã–≤–∞–µ–º –º–æ–¥–∞–ª–∫—É –∞–¥–º–∏–Ω–∞
            } else {
                alert("–ù–µ–≤–µ—Ä–Ω—ã–π –ø–∞—Ä–æ–ª—å!");
            }
        };
        // --- –õ–û–ì–ò–ö–ê –ë–û–ö–û–í–û–ì–û –ú–ï–ù–Æ --- 
const menuToggle = document.getElementById('menu-toggle');
const sideMenu = document.getElementById('side-menu');
const menuOverlay = document.getElementById('menu-overlay');
const sideMenuClose = document.getElementById('side-menu-close');
const sideMenuContent = document.getElementById('side-menu-content');
const sideMenuTitle = document.getElementById('side-menu-title');

// –§—É–Ω–∫—Ü–∏–∏ –æ—Ç–∫—Ä—ã—Ç–∏—è/–∑–∞–∫—Ä—ã—Ç–∏—è
function openMenu() {
  sideMenu.classList.remove('-translate-x-full');
  menuOverlay.classList.remove('hidden');
  menuToggle.classList.add('active');
}
function closeMenu() {
  sideMenu.classList.add('-translate-x-full');
  menuOverlay.classList.add('hidden');
  menuToggle.classList.remove('active');
}

menuToggle.addEventListener('click', openMenu);
sideMenuClose.addEventListener('click', closeMenu);
menuOverlay.addEventListener('click', closeMenu);

// –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é
function renderMainMenu() {
  sideMenuTitle.textContent = '–ú–µ–Ω—é';
  sideMenuContent.innerHTML = `
    <button class="w-full text-left py-3 px-4 rounded-lg hover:bg-orange-100 font-semibold text-gray-700" onclick="showCatalogMenu()">üìÅ –ö–∞—Ç–∞–ª–æ–≥</button>
    <button class="w-full text-left py-3 px-4 rounded-lg hover:bg-orange-100 font-semibold text-gray-700" onclick="showStoresMenu()">üè¨ –ú–∞–≥–∞–∑–∏–Ω—ã</button>
    <button class="w-full text-left py-3 px-4 rounded-lg hover:bg-orange-100 font-semibold text-gray-700" onclick="showDiscountsMenu()">üí∏ –°–∫–∏–¥–∫–∏</button>
  `;
}
renderMainMenu();

// –ö–Ω–æ–ø–∫–∞ "–ù–∞–∑–∞–¥"
function backButtonHTML() {
  return `<button onclick="renderMainMenu()" class="flex items-center text-gray-600 hover:text-orange-500 mb-4">
    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
    </svg>
    –ù–∞–∑–∞–¥
  </button>`;
}

// –ö–∞—Ç–∞–ª–æ–≥
function showCatalogMenu() {
  sideMenuTitle.textContent = '–ö–∞—Ç–∞–ª–æ–≥';
  let html = backButtonHTML();
  CATEGORIES.forEach(cat => {
    html += `<button class="block w-full text-left py-2 px-4 rounded-lg hover:bg-orange-100 text-gray-800" 
              onclick="selectCategoryFromMenu('${cat}')">${cat}</button>`;
  });
  sideMenuContent.innerHTML = html;
}
function selectCategoryFromMenu(category) {
  closeMenu();
  setActiveCategory(category);
  window.scrollTo(0, 0);
}

// –ú–∞–≥–∞–∑–∏–Ω—ã
function showStoresMenu() {
  sideMenuTitle.textContent = '–ú–∞–≥–∞–∑–∏–Ω—ã';
  let html = backButtonHTML() + `<p class="text-gray-500 text-sm mb-2">–ó–∞–≥—Ä—É–∑–∫–∞ –º–∞–≥–∞–∑–∏–Ω–æ–≤...</p>`;
  sideMenuContent.innerHTML = html;

  const storesRef = collection(db, `artifacts/${appId}/public/data/stores`);
  getDocs(storesRef).then(snapshot => {
    let html = backButtonHTML();
    if (snapshot.empty) {
      html += `<p class="text-gray-500 text-center mt-6">–ú–∞–≥–∞–∑–∏–Ω—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã.</p>`;
    } else {
      snapshot.forEach(doc => {
        const store = doc.data();
        html += `<button class="block w-full text-left py-2 px-4 rounded-lg hover:bg-orange-100 text-gray-800" 
                  onclick="filterByStore('${store.name}')">${store.name}</button>`;
      });
    }
    sideMenuContent.innerHTML = html;
  });
}
function filterByStore(storeName) {
  closeMenu();
  currentCategory = "–í—Å–µ —Ç–æ–≤–∞—Ä—ã";
  searchTerm = "";
  renderCategories();
  const filtered = allOffers.filter(o => o.storeName === storeName);
  offersListDiv.innerHTML = '';
  if (filtered.length === 0) {
    offersListDiv.innerHTML = `<div class='col-span-full text-center text-gray-500 p-8'>–ù–µ—Ç —Ç–æ–≤–∞—Ä–æ–≤ –∏–∑ –º–∞–≥–∞–∑–∏–Ω–∞ ${storeName}.</div>`;
  } else {
    filtered.forEach(offer => offersListDiv.appendChild(createOfferCard(offer)));
  }
}

// –°–∫–∏–¥–∫–∏
function showDiscountsMenu() {
  sideMenuTitle.textContent = '–°–∫–∏–¥–∫–∏';
  let html = backButtonHTML();
  sideMenuContent.innerHTML = html;
  closeMenu();
  const discounted = allOffers.filter(o => o.discount > 0);
  offersListDiv.innerHTML = '';
  if (discounted.length === 0) {
    offersListDiv.innerHTML = `<div class='col-span-full text-center text-gray-500 p-8'>–ù–µ—Ç –∞–∫—Ç–∏–≤–Ω—ã—Ö —Å–∫–∏–¥–æ–∫.</div>`;
  } else {
    discounted.forEach(offer => offersListDiv.appendChild(createOfferCard(offer)));
  }
}

// –•–µ–ª–ø–µ—Ä –¥–ª—è –∫–∞—Ä—Ç–æ—á–µ–∫ (–∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Ç—É –∂–µ –≤–µ—Ä—Å—Ç–∫—É)
function createOfferCard(offer) {
  const card = document.createElement('div');
  card.className = 'offer-card flex flex-col cursor-pointer';
  card.onclick = () => showProductDetails(offer.id);
  const activeCombo = offer.combinations?.find(c => c.isActive) || offer.combinations?.[0] || { price: 0 };
  const price = activeCombo.price || 0;
  const finalPrice = price * (1 - (offer.discount || 0) / 100);
  const image = offer.images?.[0] || `https://placehold.co/400x300?text=${encodeURIComponent(offer.title || '')}`;
  const priceHTML = offer.discount > 0
    ? `<p class="text-xl font-extrabold text-red-600">${Math.round(finalPrice)} BYN</p><p class="text-sm text-gray-400 line-through">${Math.round(price)} BYN</p>`
    : `<p class="text-xl font-extrabold text-gray-900">${Math.round(finalPrice)} BYN</p>`;
  card.innerHTML = `
    <div class="h-48 overflow-hidden relative">
      <img src="${image}" class="w-full h-full object-cover" alt="">
      ${offer.discount > 0 ? `<div class="absolute top-3 left-3 bg-red-500 text-white text-xs font-bold px-3 py-1 rounded-full">- ${offer.discount}%</div>` : ''}
    </div>
    <div class="p-5 flex flex-col flex-grow">
      <p class="text-sm font-semibold text-orange-600 mb-1">${offer.category || '–ü—Ä–æ—á–µ–µ'}</p>
      <h4 class="text-lg font-bold text-gray-900 mb-3 flex-grow">${offer.title || '–ë–µ–∑ –Ω–∞–∑–≤–∞–Ω–∏—è'}</h4>
      <div class="flex items-end justify-between mt-auto">
        <div>${priceHTML}</div>
      </div>
    </div>`;
  return card;
}

    </script>
</body>
</html>