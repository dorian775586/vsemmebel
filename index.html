<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mebel.by</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800;900&display=swap" rel="stylesheet">
    <!-- Для иконок (корзина, удаление) -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        body { font-family: 'Inter', sans-serif; background-color: #fcfcfc; min-height: 100vh; }
        .header-bg { background-color: #ffffff; box-shadow: 0 1px 3px 0 rgba(0,0,0,0.05); }
        .category-button {
            padding: 0.6rem 1.4rem; border: 2px solid #ffedd5; background-color: #ffffff;
            border-radius: 9999px; font-weight: 600; color: #4b5563; transition: all 0.3s ease;
            cursor: pointer; text-align: center; white-space: nowrap; box-shadow: 0 1px 2px rgba(0,0,0,0.05);
        }
        .category-button.active, .category-button:hover {
            border-color: #f97316; background-color: #f97316; color: #ffffff;
            box-shadow: 0 4px 6px -1px rgba(249,115,22,0.3); transform: translateY(-1px);
        }
        #category-filter::-webkit-scrollbar { display: none; }
        #category-filter { -ms-overflow-style: none; scrollbar-width: none; }
        .offer-card {
            background-color: white; border-radius: 1.25rem; overflow: hidden;
            box-shadow: 0 20px 25px -5px rgba(0,0,0,0.05),0 10px 10px -5px rgba(0,0,0,0.04);
            transition: transform 0.3s cubic-bezier(0.25,0.8,0.25,1); border: 1px solid #f3f4f6;
            position: relative; /* Для кнопки удаления */
        }
        .offer-card:hover {
            transform: translateY(-6px);
            box-shadow: 0 25px 50px -12px rgba(0,0,0,0.1),0 15px 30px -5px rgba(0,0,0,0.08);
        }
        .card-button { background-color: #f97316; box-shadow: 0 4px 10px rgba(249,115,22,0.4); }
        .card-button:hover { background-color: #ea580c; }
        .error-message { background-color: #fee2e2; color: #b91c1c; border: 1px solid #fca5a5; }
        .success-message { background-color: #d1fae5; color: #065f46; border: 1px solid #a7f3d0; }
    </style>
</head>
<body class="pb-8">

    <!-- Верхняя навигация -->
    <header class="sticky top-0 header-bg z-20">
        <div class="max-w-4xl mx-auto px-4 py-4 flex justify-between items-center">
            <h1 class="text-3xl font-black text-gray-900 tracking-tight">Mebel.by</h1>
            <div class="flex items-center space-x-4">
                <div class="flex items-center space-x-2 text-sm cursor-pointer p-2 rounded-lg hover:bg-gray-50 transition">
                    <span id="current-city" class="font-bold text-gray-700">Гомель</span>
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-gray-500" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
                    </svg>
                </div>
                <svg xmlns="http://www.w3.org/2000/svg" class="h-7 w-7 text-gray-600 cursor-pointer hover:text-orange-500 transition" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
                </svg>
                <!-- Кнопка для входа/панели админа -->
                <button id="admin-login-btn" class="bg-orange-500 text-white px-4 py-2 rounded-lg hover:bg-orange-600 transition">Админ Вход</button>
            </div>
        </div>
    </header>

    <main class="max-w-4xl mx-auto px-4 mt-6">
        <!-- Баннер -->
        <div class="p-8 md:p-12 rounded-3xl bg-gradient-to-br from-orange-500 to-red-500 text-white shadow-2xl mb-8 relative overflow-hidden">
            <div class="relative z-10 text-center">
                <p class="text-xl font-medium text-white mb-2 tracking-wider">СКИДКИ ДО 50%</p>
                <h2 class="text-4xl md:text-5xl font-extrabold mb-4 leading-tight">Ваша Новая Кухня</h2>
                <p class="text-lg font-light max-w-lg mx-auto">Получите бесплатный 3D-проект и замер уже сегодня!</p>
                <button class="mt-6 bg-white text-orange-600 font-black py-3 px-8 rounded-full transition duration-300 shadow-lg hover:bg-gray-100 uppercase text-base">
                    Записаться на замер
                </button>
            </div>
        </div>

        <!-- Поиск -->
        <div class="relative mb-8">
            <input type="text" id="search-input" placeholder="Поиск: диван, шкаф, кухня..." class="w-full py-3.5 pl-14 pr-6 text-lg border-2 border-gray-200 rounded-full focus:ring-orange-500 focus:border-orange-500 transition duration-200" />
            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 absolute left-5 top-1/2 transform -translate-y-1/2 text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
            </svg>
        </div>

        <!-- Категории -->
        <h3 class="text-2xl font-bold text-gray-800 mb-4">Каталог</h3>
        <div id="category-filter" class="flex flex-nowrap overflow-x-auto space-x-3 pb-4 scrollbar-hide">
            <!-- Кнопки категорий будут добавлены здесь JS -->
        </div>
        
        <!-- Панель Администратора -->
        <div id="admin-controls" class="hidden my-8 p-6 bg-orange-50 rounded-2xl border border-orange-200">
            <h3 class="text-xl font-bold text-gray-800 mb-4">Панель Администратора</h3>
            <button id="add-offer-open-btn" class="w-full bg-orange-600 text-white py-3 px-6 rounded-xl font-bold hover:bg-orange-700 transition duration-300 shadow-lg shadow-orange-200">
                + Добавить Новое Объявление
            </button>
        </div>


        <!-- Предложения -->
        <h3 class="text-2xl font-bold text-gray-800 my-6">Выгодные предложения</h3>
        <div id="offers-list" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-8">
            <div id="no-offers" class="col-span-full text-center text-gray-500 hidden p-8">Предложений по вашему запросу не найдено.</div>
        </div>
    </main>

    <!-- Модальное окно входа Админа -->
    <div id="admin-modal" class="fixed inset-0 bg-black/50 flex items-center justify-center hidden z-50 p-4">
        <div class="bg-white rounded-2xl p-6 w-80 relative shadow-2xl">
            <h3 class="text-xl font-bold mb-4">Вход Администратора</h3>
            <button id="admin-close" class="absolute top-3 right-3 text-gray-400 hover:text-gray-600 text-2xl font-light">&times;</button>
            
            <div id="admin-message" class="text-sm text-center font-medium my-2 p-2 rounded hidden"></div>
            
            <input type="email" id="admin-email" placeholder="Email" class="w-full mb-3 p-3 border border-gray-300 rounded-lg focus:ring-orange-500 focus:border-orange-500" />
            <input type="password" id="admin-password" placeholder="Пароль" class="w-full mb-4 p-3 border border-gray-300 rounded-lg focus:ring-orange-500 focus:border-orange-500" />
            <div class="flex justify-between space-x-2">
                <button id="admin-register" class="flex-1 bg-gray-200 text-gray-700 px-4 py-2 rounded-xl hover:bg-gray-300 transition font-medium">Регистрация</button>
                <button id="admin-login" class="flex-1 bg-orange-500 text-white px-4 py-2 rounded-xl hover:bg-orange-600 transition font-bold">Войти</button>
            </div>
        </div>
    </div>

    <!-- Модальное окно добавления/редактирования предложения -->
    <div id="add-offer-modal" class="fixed inset-0 bg-black/50 flex items-center justify-center hidden z-50 p-4">
        <div class="bg-white rounded-2xl p-6 w-11/12 max-w-lg relative shadow-2xl">
            <h3 class="text-2xl font-bold mb-4" id="offer-modal-title">Добавить Новое Объявление</h3>
            <button id="add-offer-close" class="absolute top-4 right-4 text-gray-400 hover:text-gray-600 text-2xl font-light">&times;</button>
            
            <div class="space-y-4">
                <input type="text" id="offer-name" placeholder="Название (например, Диван 'Брюссель')" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-orange-500 focus:border-orange-500" />
                
                <input type="number" id="offer-price" placeholder="Цена (BYN)" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-orange-500 focus:border-orange-500" />
                
                <textarea id="offer-description" placeholder="Описание товара" rows="3" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-orange-500 focus:border-orange-500"></textarea>
                
                <input type="url" id="offer-image-url" placeholder="URL Изображения (https://...)" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-orange-500 focus:border-orange-500" />
                <p class="text-sm text-gray-500">
                    <small>Используйте: https://placehold.co/400x300/f97316/ffffff?text=Мебель</small>
                </p>
                
                <select id="offer-category" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-orange-500 focus:border-orange-500">
                    <option value="" disabled selected>Выберите Категорию</option>
                    <!-- Categories will be populated here -->
                </select>
                
                <div id="offer-message" class="text-sm font-medium my-2 p-2 rounded hidden"></div>
                
                <button id="save-offer-btn" class="w-full bg-orange-500 text-white py-3 rounded-xl font-bold hover:bg-orange-600 transition duration-300">
                    Сохранить Объявление
                </button>
            </div>
        </div>
    </div>


    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, signInWithCustomToken, createUserWithEmailAndPassword, signInWithEmailAndPassword, signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, doc, addDoc, onSnapshot, collection, query, where, deleteDoc, setDoc, Timestamp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
        import { setLogLevel } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        // setLogLevel('Debug'); // Раскомментируйте для отладки

        // Глобальные переменные Canvas (ОБЯЗАТЕЛЬНО К ИСПОЛЬЗОВАНИЮ)
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-mebel-app';
        const firebaseConfig = typeof __firebase_config !== 'undefined' ? JSON.parse(__firebase_config) : null;
        const initialAuthToken = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : null;

        if (!firebaseConfig) {
            console.error("Firebase config is missing.");
            document.getElementById('no-offers').textContent = "Ошибка: Конфигурация Firebase отсутствует. Приложение не может загрузить данные.";
            document.getElementById('no-offers').classList.remove('hidden');
            document.getElementById('category-filter').innerHTML = '';
        }

        let db, auth;
        let currentUserId = null;
        let isAdmin = false;
        let allCategories = [];
        let currentCategoryFilter = 'all';
        let currentSearchTerm = '';

        // --- ИНИЦИАЛИЗАЦИЯ FIREBASE И АУТЕНТИФИКАЦИЯ ---

        function initializeFirebase() {
            if (!firebaseConfig) return;
            try {
                const app = initializeApp(firebaseConfig);
                db = getFirestore(app);
                auth = getAuth(app);
                
                onAuthStateChanged(auth, (user) => {
                    if (user) {
                        // User is signed in
                        console.log("User signed in:", user.uid);
                        // Простая проверка на админа (можно использовать claims в реальном приложении)
                        isAdmin = user.email === 'admin@mebel.by';
                        currentUserId = user.uid;
                    } else {
                        // User is signed out
                        console.log("User signed out / Anonymous");
                        currentUserId = null;
                        isAdmin = false;
                    }
                    updateUI(user);
                    fetchAndRenderCategories();
                    fetchAndRenderOffers();
                });

                // Первичный вход с кастомным токеном или анонимный
                if (initialAuthToken) {
                    signInWithCustomToken(auth, initialAuthToken).catch(error => {
                        console.error("Error signing in with custom token:", error);
                        signInAnonymously(auth).catch(err => console.error("Anonymous sign in failed:", err));
                    });
                } else {
                    signInAnonymously(auth).catch(error => console.error("Anonymous sign in failed:", error));
                }

            } catch (error) {
                console.error("Failed to initialize Firebase:", error);
                document.getElementById('no-offers').textContent = `Критическая ошибка инициализации: ${error.message}`;
                document.getElementById('no-offers').classList.remove('hidden');
            }
        }

        // --- UI ХЕЛПЕРЫ ---

        function showToast(elementId, message, isError = false) {
            const el = document.getElementById(elementId);
            el.textContent = message;
            el.classList.remove('hidden', 'error-message', 'success-message');
            el.classList.add(isError ? 'error-message' : 'success-message');
            setTimeout(() => {
                el.classList.add('hidden');
            }, 3000);
        }

        function updateUI(user) {
            const adminLoginBtn = document.getElementById('admin-login-btn');
            const adminControls = document.getElementById('admin-controls');
            
            if (user && !user.isAnonymous) {
                adminLoginBtn.textContent = isAdmin ? 'Панель Админа' : 'Профиль';
                adminLoginBtn.onclick = isAdmin ? () => adminControls.classList.toggle('hidden') : handleLogout;
            } else {
                adminLoginBtn.textContent = 'Админ Вход';
                adminLoginBtn.onclick = () => document.getElementById('admin-modal').classList.remove('hidden');
            }
            // Показываем/скрываем панель админа
            adminControls.classList.toggle('hidden', !isAdmin);
        }

        // --- АУТЕНТИФИКАЦИЯ АДМИНА ---

        async function handleLogin() {
            const email = document.getElementById('admin-email').value;
            const password = document.getElementById('admin-password').value;
            const msgEl = document.getElementById('admin-message');
            msgEl.classList.add('hidden');

            try {
                const userCredential = await signInWithEmailAndPassword(auth, email, password);
                if (userCredential.user.email === 'admin@mebel.by') {
                    showToast('admin-message', 'Успешный вход!', false);
                    document.getElementById('admin-modal').classList.add('hidden');
                    // updateUI вызовется через onAuthStateChanged
                } else {
                     await signOut(auth);
                     showToast('admin-message', 'Доступ только для администратора.', true);
                }
            } catch (error) {
                console.error("Login failed:", error);
                showToast('admin-message', 'Ошибка входа: ' + error.message, true);
            }
        }

        async function handleRegister() {
            const email = document.getElementById('admin-email').value;
            const password = document.getElementById('admin-password').value;
            const msgEl = document.getElementById('admin-message');
            msgEl.classList.add('hidden');

            try {
                const userCredential = await createUserWithEmailAndPassword(auth, email, password);
                showToast('admin-message', 'Успешная регистрация! Можете войти.', false);
                console.log("Registered user:", userCredential.user.uid);
            } catch (error) {
                console.error("Registration failed:", error);
                showToast('admin-message', 'Ошибка регистрации: ' + error.message, true);
            }
        }

        async function handleLogout() {
            try {
                await signOut(auth);
                // После выхода, signInAnonymously для продолжения работы
                signInAnonymously(auth); 
            } catch (error) {
                console.error("Logout failed:", error);
            }
        }

        // --- РАБОТА С КАТЕГОРИЯМИ ---

        function fetchAndRenderCategories() {
            if (!db) return;
            const categoriesRef = collection(db, 'artifacts', appId, 'public', 'data', 'categories');
            
            // Получаем категории в реальном времени
            onSnapshot(categoriesRef, (snapshot) => {
                const data = [];
                snapshot.forEach(doc => data.push({ id: doc.id, ...doc.data() }));
                allCategories = data;
                renderCategories(data);
            }, (error) => {
                console.error("Error fetching categories:", error);
            });
        }

        function renderCategories(categories) {
            const filterEl = document.getElementById('category-filter');
            const selectEl = document.getElementById('offer-category');

            // 1. Рендеринг кнопок фильтра
            filterEl.innerHTML = '';
            
            const allBtn = document.createElement('button');
            allBtn.textContent = 'Все';
            allBtn.className = `category-button ${currentCategoryFilter === 'all' ? 'active' : ''}`;
            allBtn.setAttribute('data-category', 'all');
            filterEl.appendChild(allBtn);

            categories.forEach(cat => {
                const btn = document.createElement('button');
                btn.textContent = cat.name;
                btn.className = `category-button ${currentCategoryFilter === cat.id ? 'active' : ''}`;
                btn.setAttribute('data-category', cat.id);
                filterEl.appendChild(btn);
            });

            // 2. Рендеринг в dropdown для модального окна добавления
            const selectedValue = selectEl.value; // Сохраняем выбранное значение
            selectEl.innerHTML = '<option value="" disabled selected>Выберите Категорию</option>';
            categories.forEach(cat => {
                const option = document.createElement('option');
                option.value = cat.id;
                option.textContent = cat.name;
                selectEl.appendChild(option);
            });
            selectEl.value = selectedValue; // Восстанавливаем выбранное значение
        }

        function handleCategoryFilter(categoryId) {
            currentCategoryFilter = categoryId;
            // Обновляем состояние кнопок
            document.querySelectorAll('.category-button').forEach(btn => {
                btn.classList.toggle('active', btn.getAttribute('data-category') === categoryId);
            });
            fetchAndRenderOffers();
        }


        // --- РАБОТА С ОБЪЯВЛЕНИЯМИ (OFFERS) ---

        function fetchAndRenderOffers() {
            if (!db) return;
            const offersRef = collection(db, 'artifacts', appId, 'public', 'data', 'offers');
            let q = offersRef;

            // onSnapshot для живого обновления
            onSnapshot(q, (snapshot) => {
                const offersData = [];
                snapshot.forEach(doc => offersData.push({ id: doc.id, ...doc.data() }));
                renderOffers(offersData);
            }, (error) => {
                console.error("Error fetching offers:", error);
            });
        }

        function renderOffers(offers) {
            const listEl = document.getElementById('offers-list');
            const noOffersEl = document.getElementById('no-offers');
            listEl.innerHTML = '';
            
            // 1. Фильтрация и Поиск
            const filteredOffers = offers.filter(offer => {
                const matchesCategory = currentCategoryFilter === 'all' || offer.category === currentCategoryFilter;
                
                const searchLower = currentSearchTerm.toLowerCase();
                const matchesSearch = !searchLower || 
                                    offer.name.toLowerCase().includes(searchLower) || 
                                    (offer.description || '').toLowerCase().includes(searchLower);

                return matchesCategory && matchesSearch;
            }).sort((a, b) => (b.timestamp?.seconds || 0) - (a.timestamp?.seconds || 0)); // Сортировка по дате добавления

            if (filteredOffers.length === 0) {
                noOffersEl.classList.remove('hidden');
                return;
            } else {
                noOffersEl.classList.add('hidden');
            }

            // 2. Рендеринг карточек
            filteredOffers.forEach(offer => {
                const categoryName = allCategories.find(c => c.id === offer.category)?.name || 'Не указана';
                const card = document.createElement('div');
                card.className = 'offer-card flex flex-col';

                // HTML-структура карточки
                card.innerHTML = `
                    ${isAdmin ? `<button class="absolute top-3 right-3 p-2 bg-red-600 text-white rounded-full z-10 hover:bg-red-700 transition delete-offer-btn" data-id="${offer.id}">
                        <i class="fas fa-trash-alt text-sm"></i>
                    </button>` : ''}
                    <div class="h-40 bg-gray-100 overflow-hidden relative">
                        <img src="${offer.imageUrl}" alt="${offer.name}" 
                            class="w-full h-full object-cover transition duration-500 ease-in-out hover:scale-105" 
                            onerror="this.onerror=null;this.src='https://placehold.co/400x300/f3f4f6/9ca3af?text=Нет+Фото';"
                        >
                    </div>
                    <div class="p-5 flex-grow flex flex-col">
                        <span class="text-xs font-semibold uppercase text-orange-600 tracking-wider mb-1">${categoryName}</span>
                        <h4 class="text-xl font-extrabold text-gray-900 mb-2 truncate">${offer.name}</h4>
                        <p class="text-sm text-gray-500 mb-3 flex-grow line-clamp-2">${offer.description}</p>
                        <div class="flex items-center justify-between mt-auto pt-3 border-t border-gray-100">
                            <span class="text-2xl font-black text-gray-900">${offer.price} BYN</span>
                            <button class="card-button text-white font-bold py-2 px-4 rounded-full text-sm transition duration-300">
                                Заказать
                            </button>
                        </div>
                    </div>
                `;
                listEl.appendChild(card);
            });
            
            // Прикрепляем слушателей удаления
            if (isAdmin) {
                document.querySelectorAll('.delete-offer-btn').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        const offerId = e.currentTarget.getAttribute('data-id');
                        if (confirm('Вы уверены, что хотите удалить это объявление?')) {
                            deleteOffer(offerId);
                        }
                    });
                });
            }
        }

        // --- CRUD ОБЪЯВЛЕНИЙ (АДМИН) ---
        
        async function addNewOffer() {
            const name = document.getElementById('offer-name').value.trim();
            const price = parseFloat(document.getElementById('offer-price').value);
            const description = document.getElementById('offer-description').value.trim();
            const imageUrl = document.getElementById('offer-image-url').value.trim();
            const category = document.getElementById('offer-category').value;
            const msgEl = document.getElementById('offer-message');

            if (!name || isNaN(price) || !description || !category) {
                showToast('offer-message', 'Заполните все обязательные поля (Название, Цена, Описание, Категория).', true);
                return;
            }

            const newOffer = {
                name,
                price,
                description,
                category,
                imageUrl: imageUrl || 'https://placehold.co/400x300/f3f4f6/9ca3af?text=Нет+Фото',
                timestamp: Timestamp.now(),
                // В реальном приложении здесь был бы userId для отслеживания автора
            };

            try {
                const offersRef = collection(db, 'artifacts', appId, 'public', 'data', 'offers');
                await addDoc(offersRef, newOffer);
                
                showToast('offer-message', 'Объявление успешно добавлено!', false);
                
                // Очистка формы
                document.getElementById('offer-name').value = '';
                document.getElementById('offer-price').value = '';
                document.getElementById('offer-description').value = '';
                document.getElementById('offer-image-url').value = '';
                document.getElementById('offer-category').value = ''; // Сброс
                
                // Закрытие модального окна через 1 секунду
                setTimeout(() => document.getElementById('add-offer-modal').classList.add('hidden'), 1000);

            } catch (error) {
                console.error("Error adding offer:", error);
                showToast('offer-message', 'Ошибка при добавлении: ' + error.message, true);
            }
        }
        
        async function deleteOffer(offerId) {
            if (!db || !isAdmin) return;
            try {
                const docRef = doc(db, 'artifacts', appId, 'public', 'data', 'offers', offerId);
                await deleteDoc(docRef);
                console.log("Offer successfully deleted:", offerId);
            } catch (error) {
                console.error("Error deleting offer:", error);
                alert('Ошибка удаления объявления. Смотрите консоль.'); // Используем alert только для критической ошибки, т.к. нет отдельного тоста
            }
        }


        // --- СЛУШАТЕЛИ СОБЫТИЙ ---

        function setupEventListeners() {
            // Аутентификация
            document.getElementById('admin-login-btn').addEventListener('click', () => {
                if (!auth.currentUser || auth.currentUser.isAnonymous) {
                    document.getElementById('admin-modal').classList.remove('hidden');
                }
            });
            document.getElementById('admin-close').addEventListener('click', () => document.getElementById('admin-modal').classList.add('hidden'));
            document.getElementById('admin-login').addEventListener('click', handleLogin);
            document.getElementById('admin-register').addEventListener('click', handleRegister);

            // Админ: Добавить объявление
            document.getElementById('add-offer-open-btn').addEventListener('click', () => document.getElementById('add-offer-modal').classList.remove('hidden'));
            document.getElementById('add-offer-close').addEventListener('click', () => document.getElementById('add-offer-modal').classList.add('hidden'));
            document.getElementById('save-offer-btn').addEventListener('click', addNewOffer);
            
            // Фильтр категорий
            document.getElementById('category-filter').addEventListener('click', (e) => {
                if (e.target.classList.contains('category-button')) {
                    handleCategoryFilter(e.target.getAttribute('data-category'));
                }
            });

            // Поиск
            document.getElementById('search-input').addEventListener('input', (e) => {
                currentSearchTerm = e.target.value.trim();
                fetchAndRenderOffers();
            });
        }


        // --- ЗАПУСК ПРИЛОЖЕНИЯ ---
        window.onload = function() {
            initializeFirebase();
            setupEventListeners();
        }

    </script>
</body>
</html>
