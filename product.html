<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ğ¡Ñ‚Ñ€Ğ°Ğ½Ğ¸Ñ†Ğ° Ñ‚Ğ¾Ğ²Ğ°Ñ€Ğ°</title>
<script src="https://cdn.tailwindcss.com"></script>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800;900&display=swap" rel="stylesheet">
<style>
body { font-family: 'Inter', sans-serif; background-color: #fcfcfc; min-height: 100vh; transition: background 0.3s; }
.header-bg { background-color: #ffffff; box-shadow: 0 1px 3px rgba(0,0,0,0.05);}
.orange-accent { background-color: #f97316; color:white; font-weight:700; transition:0.3s; }
.orange-accent:hover:not(:disabled) { background-color: #ea580c; }
.orange-accent:disabled { background-color: #fca5a5; cursor: not-allowed; } 

.option-button-style { 
    border:2px solid #f97316; 
    background:#ffedd5; 
    color:#f97316; 
    font-weight:600; 
    transition:0.2s; 
    padding: 0.5rem 1rem; 
    border-radius: 0.5rem; 
    cursor:pointer; 
    min-width: 80px; 
    text-align: center;
}
.option-button-style:hover { 
    background:#f97316; 
    color:#fff; 
}
.option-button-style.active { 
    background:#fff; 
    color:#f97316; 
    border:3px solid #f97316; 
    box-shadow:0 0 0 3px rgba(249,115,22,0.4);
}

.thumbnail { width:60px; height:60px; border:2px solid transparent; cursor:pointer; border-radius:0.5rem; transition:0.2s; object-fit: cover; }
.thumbnail:hover { transform: scale(1.05); box-shadow:0 2px 5px rgba(249,115,22,0.3); } 
.thumbnail.active { border-color:#f97316; box-shadow:0 4px 12px rgba(249,115,22,0.4); } 

#main-product-image { transition: opacity 0.3s ease-in-out; } 
#message-box { position: fixed; top: 20px; right: 20px; z-index: 1000; min-width: 300px; padding: 1rem; background-color: #10b981; color: white; border-radius: 0.75rem; box-shadow: 0 4px 6px rgba(0,0,0,0.1); opacity: 0; transition: opacity 0.5s, transform 0.5s; transform: translateY(-10px); } 
#message-box.show { opacity: 1; transform: translateY(0); }

/* --- ĞĞĞ’Ğ«Ğ™ Ğ¡Ğ¢Ğ˜Ğ›Ğ¬ Ğ”Ğ›Ğ¯ Ğ›Ğ˜ĞŸĞšĞĞ™ ĞšĞĞ›ĞĞĞšĞ˜ --- */
/* Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµĞ¼ Tail CSS ĞºĞ»Ğ°ÑÑÑ‹ sticky Ğ¸ top-20 Ğ²Ğ¼ĞµÑÑ‚Ğ¾ ĞºĞ°ÑÑ‚Ğ¾Ğ¼Ğ½Ğ¾Ğ³Ğ¾ .sticky-column, ĞºĞ°Ğº Ğ² Ğ¿Ñ€Ğ°Ğ²Ğ¾Ğ¹ ĞºĞ¾Ğ»Ğ¾Ğ½ĞºĞµ Ğ½Ğ¸Ğ¶Ğµ */
</style>
</head>
<body class="pb-20">

<header class="sticky top-0 header-bg z-20">
Â  <div class="max-w-6xl mx-auto px-4 py-4 flex justify-between items-center">
Â  Â  Â  Â  <a href="/" class="text-3xl font-black text-gray-900 tracking-tight">
Â  Â  Â  Mebel.by
Â  Â  </a>

Â  Â  Â  Â  <div class="flex items-center gap-6">
Â  Â  Â  
Â  Â  Â  Â  Â  Â  <a href="favorites.html" 
Â  Â  Â  Â  Â class="text-gray-700 hover:text-orange-500 transition transform hover:scale-110" 
Â  Â  Â  Â  Â title="Ğ˜Ğ·Ğ±Ñ€Ğ°Ğ½Ğ½Ğ¾Ğµ">
Â  Â  Â  Â  <svg xmlns="http://www.w3.org/2000/svg" 
Â  Â  Â  Â  Â  Â  Â fill="none" 
Â  Â  Â  Â  Â  Â  Â viewBox="0 0 24 24" 
Â  Â  Â  Â  Â  Â  Â stroke-width="1.8" 
Â  Â  Â  Â  Â  Â  Â stroke="currentColor" 
Â  Â  Â  Â  Â  Â  Â class="w-7 h-7">
Â  Â  Â  Â  Â  <path stroke-linecap="round" stroke-linejoin="round" 
Â  Â  Â  Â  Â  Â  Â  Â  d="M12 21s-6.5-4.6-9.3-8.7C.7 9.2 2.4 4.5 6.3 3.4c1.9-.5 3.9.3 5.1 1.9 1.2-1.6 3.2-2.4 5.1-1.9 3.9 1.1 5.6 5.8 3.6 8.9C18.5 16.4 12 21 12 21z" />
Â  Â  Â  Â  </svg>
Â  Â  Â  </a>

Â  Â  Â  Â  Â  Â  <a href="order.html" 
Â  Â  Â  Â  Â class="text-gray-700 hover:text-orange-500 transition transform hover:scale-110" 
Â  Â  Â  Â  Â title="ĞšĞ¾Ñ€Ğ·Ğ¸Ğ½Ğ°">
Â  Â  Â  Â  <svg xmlns="http://www.w3.org/2000/svg" 
Â  Â  Â  Â  Â  Â  Â fill="none" 
Â  Â  Â  Â  Â  Â  Â viewBox="0 0 24 24" 
Â  Â  Â  Â  Â  Â  Â stroke-width="1.8" 
Â  Â  Â  Â  Â  Â  Â stroke="currentColor" 
Â  Â  Â  Â  Â  Â  Â class="w-7 h-7">
Â  Â  Â  Â  Â  <path stroke-linecap="round" stroke-linejoin="round" 
Â  Â  Â  Â  Â  Â  Â  Â  d="M3 3h2l.4 2M7 13h10l4-8H5.4M7 13l-1.6 8h13.2L17 13M9 21h6" />
Â  Â  Â  Â  </svg>
Â  Â  Â  </a>
Â  Â  </div>
Â  </div>
</header>


<main class="max-w-6xl mx-auto px-4 mt-6">
Â  <div class="mb-6 text-sm text-gray-500">
Â  Â  <a href="/" class="hover:text-orange-500 transition">Ğ“Ğ»Ğ°Ğ²Ğ½Ğ°Ñ</a>
Â  Â  <span class="mx-2">/</span>
Â  Â  <a href="#" class="hover:text-orange-500 transition" id="breadcrumb-category">ĞšĞ°Ñ‚ĞµĞ³Ğ¾Ñ€Ğ¸Ñ</a>
Â  Â  <span class="mx-2">/</span>
Â  Â  <span class="text-gray-900 font-medium" id="breadcrumb-title">Ğ¢Ğ¾Ğ²Ğ°Ñ€</span>
Â  </div>

Â  <div class="lg:grid lg:grid-cols-2 lg:gap-10">
    Â  Â  <div class="mb-8 lg:mb-0">
Â  Â  Â  <div id="thumbnail-gallery" class="flex gap-3 mb-3"></div>
Â  Â  Â  <img id="main-product-image" src="https://placehold.co/800x600?text=ĞĞµÑ‚+Ğ¸Ğ·Ğ¾Ğ±Ñ€Ğ°Ğ¶ĞµĞ½Ğ¸Ñ" class="w-full h-auto rounded-3xl object-cover" style="max-height: 600px;">
        
        <div class="mt-8 p-6 bg-white rounded-3xl shadow-lg">
            <h2 class="text-2xl font-bold text-gray-900 mb-4">ĞĞ¿Ğ¸ÑĞ°Ğ½Ğ¸Ğµ</h2>
            <p class="text-gray-600 mb-0" id="product-description">Ğ—Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ° Ğ¾Ğ¿Ğ¸ÑĞ°Ğ½Ğ¸Ñ...</p>
        </div>
        Â  Â  </div>

    Â  Â  <div class="p-6 bg-white rounded-3xl shadow-2xl sticky top-20 h-fit">
Â  Â  Â  <h1 class="text-4xl font-black text-gray-900 mb-2" id="product-title">Ğ¢Ğ¾Ğ²Ğ°Ñ€</h1>
Â  Â  Â  <p class="text-lg font-medium text-orange-600 uppercase mb-4" id="product-category">ĞšĞ°Ñ‚ĞµĞ³Ğ¾Ñ€Ğ¸Ñ</p>

Â  Â  Â  <div class="mb-5 flex items-end">
Â  Â  Â  Â  <span id="old-price" class="line-through text-xl text-gray-400 mr-3 transition duration-300 ease-in-out">0 BYN</span>
Â  Â  Â  Â  <span id="new-price" class="text-4xl font-black text-orange-600 transition duration-300 ease-in-out">0 BYN</span>
Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  <div class="mb-5 hidden" id="facade-section">
Â  Â  Â  Â  <p class="font-bold text-gray-800 mb-3">Ğ¤Ğ°ÑĞ°Ğ´:</p>
Â  Â  Â  Â  <div class="flex flex-wrap gap-3" id="facade-options"></div>
Â  Â  Â  </div>

Â  Â  Â  <div class="mb-5 hidden" id="material-section">
Â  Â  Â  Â  <p class="font-bold text-gray-800 mb-3">ĞœĞ°Ñ‚ĞµÑ€Ğ¸Ğ°Ğ»:</p>
Â  Â  Â  Â  <div class="flex flex-wrap gap-3" id="material-options"></div>
Â  Â  Â  </div>

Â  Â  Â  <div class="mb-8 hidden" id="color-section">
Â  Â  Â  Â  <p class="font-bold text-gray-800 mb-3">Ğ¦Ğ²ĞµÑ‚/Ğ¢ĞµĞºÑÑ‚ÑƒÑ€Ğ°:</p>
Â  Â  Â  Â  <div class="flex flex-wrap gap-3" id="color-options"></div>
Â  Â  Â  </div>

Â  Â  Â  <div class="flex flex-col space-y-4">
Â  Â  Â  Â  <button id="buy-button" class="orange-accent text-white font-black text-lg py-4 rounded-xl uppercase">Ğ’ ĞºĞ¾Ñ€Ğ·Ğ¸Ğ½Ñƒ</button>
Â  Â  Â  Â  <button id="favorite-button" class="border-2 border-orange-500 text-orange-500 font-bold text-lg py-3 rounded-xl uppercase hover:bg-orange-50 transition">Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ Ğ² Ğ¸Ğ·Ğ±Ñ€Ğ°Ğ½Ğ½Ğ¾Ğµ â¤ï¸</button>
Â  Â  Â  </div>

Â  Â  Â  <div class="mt-4 p-3 bg-red-100 text-red-700 rounded-lg text-sm hidden" id="error-message">
Â  Â  Â  Â  <p>Ğ­Ñ‚Ğ° ĞºĞ¾Ğ¼Ğ±Ğ¸Ğ½Ğ°Ñ†Ğ¸Ñ Ğ¾Ğ¿Ñ†Ğ¸Ğ¹ Ğ½ĞµĞ´Ğ¾ÑÑ‚ÑƒĞ¿Ğ½Ğ°.</p>
Â  Â  Â  </div>
Â  Â  </div>
Â  </div>
</main>

<div id="message-box" role="alert"></div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
import { getFirestore, doc, getDoc, collection, query, getDocs, limit, setLogLevel } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
import { getAuth, signInAnonymously, signInWithCustomToken } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";

let productData = null;
let selectedFacade = null;
let selectedMaterial = null;
let selectedColor = null;

const urlParams = new URLSearchParams(window.location.search);
let productId = urlParams.get('id');

const HARDCODED_FIREBASE_CONFIG = {
Â  apiKey: "AIzaSyA-LeQHKV4NfJrTKQCGjG-VQGhfWxtPk70",
Â  authDomain: "vsemmebel-90d48.firebaseapp.com",
Â  projectId: "vsemmebel-90d48",
Â  storageBucket: "vsemmebel-90d48.appspot.com",
Â  messagingSenderId: "958123504041",
Â  appId: "1:958123504041:web:1f14f4561d6bb6628494b8"
};

const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
const firebaseConfigString = typeof __firebase_config !== 'undefined' ? __firebase_config : '{}';
const initialAuthToken = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : null;

let firebaseConfig = {};
try {
Â  const parsedConfig = JSON.parse(firebaseConfigString);
Â  firebaseConfig = parsedConfig?.projectId ? parsedConfig : HARDCODED_FIREBASE_CONFIG;
} catch {
Â  firebaseConfig = HARDCODED_FIREBASE_CONFIG;
}

const COLLECTION_PATH = `/artifacts/${appId}/public/data/offers`;
let app, db, auth, isAuthReady = false;

// ==========================
// Firebase Ğ¸ Ğ·Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ° Ğ¿Ñ€Ğ¾Ğ´ÑƒĞºÑ‚Ğ°
// ==========================
async function initializeAuthAndFirestore() {
Â  app = initializeApp(firebaseConfig);
Â  db = getFirestore(app);
Â  auth = getAuth(app);
Â  setLogLevel('Debug');
Â  try {
Â  Â  if (initialAuthToken) await signInWithCustomToken(auth, initialAuthToken);
Â  Â  else await signInAnonymously(auth);
Â  Â  isAuthReady = true;
Â  Â  if (!productId) findFirstAvailableProduct();
Â  Â  else loadProduct(productId);
Â  } catch {
Â  Â  showMessage("ĞÑˆĞ¸Ğ±ĞºĞ° Ğ°Ğ²Ñ‚Ğ¾Ñ€Ğ¸Ğ·Ğ°Ñ†Ğ¸Ğ¸. Ğ”Ğ°Ğ½Ğ½Ñ‹Ğµ Ğ¼Ğ¾Ğ³ÑƒÑ‚ Ğ±Ñ‹Ñ‚ÑŒ Ğ½ĞµĞ´Ğ¾ÑÑ‚ÑƒĞ¿Ğ½Ñ‹.", true);
Â  }
}

async function findFirstAvailableProduct() {
Â  if (!isAuthReady) return;
Â  const q = query(collection(db, COLLECTION_PATH), limit(1));
Â  const querySnapshot = await getDocs(q);
Â  if (!querySnapshot.empty) {
Â  Â  const firstDoc = querySnapshot.docs[0];
Â  Â  productId = firstDoc.id;
Â  Â  window.history.pushState({}, '', `?id=${productId}`);
Â  Â  loadProduct(productId);
Â  } else showMessage(`ĞÑˆĞ¸Ğ±ĞºĞ°: ĞºĞ¾Ğ»Ğ»ĞµĞºÑ†Ğ¸Ñ '${COLLECTION_PATH}' Ğ¿ÑƒÑÑ‚Ğ°.`, true);
}

async function loadProduct(id) {
Â  if (!isAuthReady) return;
Â  const docRef = doc(db, COLLECTION_PATH, id);
Â  const docSnap = await getDoc(docRef);
Â  if (docSnap.exists()) {
Â  Â  productData = docSnap.data();
Â  Â  if (productData.combinations && productData.image_color_map) {
Â  Â  Â  productData.combinations.forEach(combo => {
Â  Â  Â  Â  const colorName = combo.color;
Â  Â  Â  Â  const imageObj = productData.image_color_map.find(m => m.color === colorName);
Â  Â  Â  Â  combo.colorImage = imageObj?.url || null;
Â  Â  Â  });
Â  Â  }
Â  Â  initializeProductView(productData);
Â  } else {
Â  Â  findFirstAvailableProduct();
Â  }
}

// ==========================
// Ğ’ÑĞ¿Ğ¾Ğ¼Ğ¾Ğ³Ğ°Ñ‚ĞµĞ»ÑŒĞ½Ñ‹Ğµ Ñ„ÑƒĞ½ĞºÑ†Ğ¸Ğ¸
// ==========================
function renderGallery(images) {
Â  const gallery = document.getElementById("thumbnail-gallery");
Â  gallery.innerHTML = "";
Â  images.forEach((img, i) => {
Â  Â  const thumb = document.createElement("img");
Â  Â  thumb.src = img;
Â  Â  thumb.className = "thumbnail" + (i === 0 ? " active" : "");
Â  Â  thumb.onerror = () => thumb.src = "https://placehold.co/60x60?text=IMG";
Â  Â  thumb.onclick = () => {
Â  Â  Â  const mainImage = document.getElementById("main-product-image");
Â  Â  Â  mainImage.style.opacity = 0;
Â  Â  Â  setTimeout(() => { mainImage.src = img; mainImage.style.opacity = 1; }, 200);
Â  Â  Â  gallery.querySelectorAll("img").forEach(t => t.classList.remove("active"));
Â  Â  Â  thumb.classList.add("active");
Â  Â  };
Â  Â  gallery.appendChild(thumb);
Â  });
Â  const mainImage = document.getElementById("main-product-image");
Â  mainImage.src = images[0] || "https://placehold.co/800x600?text=ĞĞµÑ‚+Ğ¸Ğ·Ğ¾Ğ±Ñ€Ğ°Ğ¶ĞµĞ½Ğ¸Ñ";
}

function renderOptions(containerId, options, clickHandler) {
Â  const container = document.getElementById(containerId);
Â  if (!options || options.length === 0) {
Â  Â  container.parentElement.classList.add("hidden");
Â  Â  return;
Â  }
Â  container.parentElement.classList.remove("hidden");
Â  container.innerHTML = "";
Â  options.forEach(o => {
Â  Â  const btn = document.createElement("button");
Â  Â  btn.textContent = o;
Â  Â  btn.dataset.value = o;
Â  Â  btn.className = "option-button-style";
Â  Â  btn.onclick = () => {
Â  Â  Â  clickHandler(o);
Â  Â  Â  updateProductView();
Â  Â  Â  saveSelectedOptions();
Â  Â  };
Â  Â  container.appendChild(btn);
Â  });
}

function renderColorOptions(containerId, colors, clickHandler) {
Â  const container = document.getElementById(containerId);
Â  if (!colors || colors.length === 0) {
Â  Â  container.parentElement.classList.add("hidden");
Â  Â  return;
Â  }
Â  container.parentElement.classList.remove("hidden");
Â  container.innerHTML = "";
Â  colors.forEach(c => {
Â  Â  const btn = document.createElement("button");
Â  Â  btn.textContent = c.name;
Â  Â  btn.dataset.value = c.name;
Â  Â  btn.className = "option-button-style";
Â  Â  btn.style.background = c.hex;
Â  Â  btn.style.color = getTextColorForBackground(c.hex);
Â  Â  btn.style.borderColor = c.hex;
Â  Â  btn.onclick = () => {
Â  Â  Â  clickHandler(c.name);
Â  Â  Â  updateProductView();
Â  Â  Â  saveSelectedOptions();
Â  Â  };
Â  Â  container.appendChild(btn);
Â  });
}

function getTextColorForBackground(bgColor) {
Â  if (!bgColor) return "#f97316";
Â  const c = bgColor.charAt(0) === '#' ? bgColor.substring(1,7) : bgColor;
Â  const r = parseInt(c.substring(0,2),16);
Â  const g = parseInt(c.substring(2,4),16);
Â  const b = parseInt(c.substring(4,6),16);
Â  const brightness = (r*299 + g*587 + b*114)/1000;
Â  return brightness > 150 ? "#000" : "#fff";
}

function findCombination() {
Â  if (!productData || !productData.combinations) return null;
Â  let combo = productData.combinations.find(c =>
Â  Â  c.material === selectedMaterial &&
Â  Â  c.facade === selectedFacade &&
Â  Â  c.color === selectedColor
Â  );
Â  if (combo) return combo;
Â  combo = productData.combinations.find(c => true);
Â  selectedMaterial = combo.material;
Â  selectedFacade = combo.facade;
Â  selectedColor = combo.color;
Â  return combo;
}

// ==========================
// Ğ˜Ğ½Ğ¸Ñ†Ğ¸Ğ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ Ğ²Ğ¸Ğ´Ğ° Ğ¿Ñ€Ğ¾Ğ´ÑƒĞºÑ‚Ğ°
// ==========================
function initializeProductView(data) {
Â  document.getElementById("product-title").textContent = data.title || "Ğ‘ĞµĞ· Ğ½Ğ°Ğ·Ğ²Ğ°Ğ½Ğ¸Ñ";
Â  document.getElementById("breadcrumb-title").textContent = data.title || "Ğ‘ĞµĞ· Ğ½Ğ°Ğ·Ğ²Ğ°Ğ½Ğ¸Ñ";
Â  document.getElementById("breadcrumb-category").textContent = data.category || "-";
Â  document.getElementById("product-category").textContent = data.category || "-";
Â  
  // Ğ­Ğ¢ĞĞ¢ ĞšĞĞ” Ğ—ĞĞŸĞĞ›ĞĞ¯Ğ•Ğ¢ Ğ‘Ğ›ĞĞš ĞĞŸĞ˜Ğ¡ĞĞĞ˜Ğ¯, Ğ“Ğ”Ğ• Ğ‘Ğ« ĞĞ ĞĞ˜ ĞĞĞ¥ĞĞ”Ğ˜Ğ›Ğ¡Ğ¯
Â  document.getElementById("product-description").textContent = data.description || "ĞŸĞ¾Ğ´Ñ€Ğ¾Ğ±Ğ½Ğ¾Ğµ Ğ¾Ğ¿Ğ¸ÑĞ°Ğ½Ğ¸Ğµ Ñ‚Ğ¾Ğ²Ğ°Ñ€Ğ° Ğ¾Ñ‚ÑÑƒÑ‚ÑÑ‚Ğ²ÑƒĞµÑ‚.";

Â  renderGallery(data.images || [data.image].filter(Boolean));
Â  renderOptions("facade-options", data.facades, v => selectedFacade = v);
Â  renderOptions("material-options", data.materials, v => selectedMaterial = v);
Â  renderColorOptions("color-options", data.colors, v => selectedColor = v);

Â  // Ğ’Ğ¾ÑÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ğµ Ğ²Ñ‹Ğ±Ñ€Ğ°Ğ½Ğ½Ñ‹Ñ… Ğ¾Ğ¿Ñ†Ğ¸Ğ¹ Ğ¸Ğ· localStorage
Â  const savedOptions = JSON.parse(localStorage.getItem(`selected-options-${productId}`) || '{}');
Â  selectedFacade = savedOptions.facade || data.combinations?.[0]?.facade || data.facades?.[0];
Â  selectedMaterial = savedOptions.material || data.combinations?.[0]?.material || data.materials?.[0];
Â  selectedColor = savedOptions.color || data.combinations?.[0]?.color || data.colors?.[0]?.name;

Â  updateProductView();
}

// ==========================
// ĞĞ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ğµ Ğ²Ğ¸Ğ´Ğ° Ğ¿Ñ€Ğ¾Ğ´ÑƒĞºÑ‚Ğ°
// ==========================
function updateProductView() {
Â  if (!productData) return;

Â  const combo = findCombination();
Â  if (!combo) return;

Â  updateOptionButtons("material-options", selectedMaterial);
Â  updateOptionButtons("facade-options", selectedFacade);
Â  updateOptionButtons("color-options", selectedColor);

Â  const buyButton = document.getElementById("buy-button");
Â  const errorMessage = document.getElementById("error-message");

Â  errorMessage.classList.add("hidden");

Â  const basePrice = combo.price || 0;
Â  const discount = combo.discount || 0;
Â  const oldPriceEl = document.getElementById("old-price");
Â  const newPriceEl = document.getElementById("new-price");
Â  oldPriceEl.textContent = formatPrice(basePrice);
Â  newPriceEl.textContent = formatPrice(Math.round(basePrice * (1 - discount / 100)));
Â  oldPriceEl.style.display = discount > 0 ? "inline" : "none";

Â  const mainImage = document.getElementById("main-product-image");
Â  mainImage.style.opacity = 0;
Â  setTimeout(() => {
Â  Â  Â  mainImage.src = combo.colorImage || productData.images?.[0] || "https://placehold.co/800x600?text=ĞĞµÑ‚+Ğ¸Ğ·Ğ¾Ğ±Ñ€Ğ°Ğ¶ĞµĞ½Ğ¸Ñ";
Â  Â  Â  mainImage.style.opacity = 1;
Â  }, 150);

Â  buyButton.disabled = false;
Â  buyButton.textContent = "Ğ’ ĞºĞ¾Ñ€Ğ·Ğ¸Ğ½Ñƒ";
}

function updateOptionButtons(containerId, value) {
Â  const container = document.getElementById(containerId);
Â  if (!container) return;
Â  container.querySelectorAll("button").forEach(btn=>{
Â  Â  btn.classList.toggle("active", btn.dataset.value === value);
Â  });
}

function formatPrice(price){return isNaN(price)?"N/A":price.toLocaleString("ru-RU",{style:"currency",currency:"BYN",maximumFractionDigits:0});}

// ==========================
// ĞšĞ¾Ñ€Ğ·Ğ¸Ğ½Ğ° Ğ¸ Ğ¸Ğ·Ğ±Ñ€Ğ°Ğ½Ğ½Ğ¾Ğµ
// ==========================
function addToCart(item) {
Â  let cart = JSON.parse(localStorage.getItem("cart") || "[]");
Â  if (!cart.some(i => i.id === item.id && i.material===item.material && i.facade===item.facade && i.color===item.color)) {
Â  Â  cart.push(item);
Â  Â  localStorage.setItem("cart", JSON.stringify(cart));
Â  }
}

function addToFavorites(item) {
Â  let favorites = JSON.parse(localStorage.getItem("favorites") || "[]");
Â  if (!favorites.some(i => i.id === item.id)) {
Â  Â  favorites.push(item);
Â  Â  localStorage.setItem("favorites", JSON.stringify(favorites));
Â  }
}

function saveSelectedOptions() {
Â  localStorage.setItem(`selected-options-${productId}`, JSON.stringify({
Â  Â  facade: selectedFacade,
Â  Â  material: selectedMaterial,
Â  Â  color: selectedColor
Â  }));
}

// ==========================
// ĞšĞ½Ğ¾Ğ¿ĞºĞ¸ Ğ´ĞµĞ¹ÑÑ‚Ğ²Ğ¸Ğ¹
// ==========================
document.getElementById("buy-button").addEventListener("click", () => {
Â  const comboText = `ĞœĞ°Ñ‚ĞµÑ€Ğ¸Ğ°Ğ»: ${selectedMaterial||'-'}, Ğ¤Ğ°ÑĞ°Ğ´: ${selectedFacade||'-'}, Ğ¦Ğ²ĞµÑ‚: ${selectedColor||'-'}`;
Â  const price = productData.combinations.find(c => c.material===selectedMaterial && c.facade===selectedFacade && c.color===selectedColor)?.price || 0;
Â  addToCart({
Â  Â  id: productId,
Â  Â  title: productData.title,
Â  Â  image: productData.images?.[0],
Â  Â  price: price,
Â  Â  material: selectedMaterial,
Â  Â  facade: selectedFacade,
Â  Â  shopId: productData.shopId,
Â  Â  color: selectedColor
Â  });
Â  saveSelectedOptions();
Â  showMessage(`ğŸ›’ Ğ¢Ğ¾Ğ²Ğ°Ñ€ Ğ´Ğ¾Ğ±Ğ°Ğ²Ğ»ĞµĞ½ Ğ² ĞºĞ¾Ñ€Ğ·Ğ¸Ğ½Ñƒ.<br>${comboText}<br>Ğ¦ĞµĞ½Ğ°: ${formatPrice(price)}`, false);
});

document.getElementById("favorite-button").addEventListener("click", () => {
Â  const price = productData.combinations.find(c => c.material===selectedMaterial && c.facade===selectedFacade && c.color===selectedColor)?.price || 0;
Â  addToFavorites({
Â  Â  id: productId,
Â  Â  title: productData.title,
Â  Â  image: productData.images?.[0],
Â  Â  price: price,
Â  Â  material: selectedMaterial,
Â  Â  facade: selectedFacade,
Â  Â  shopId: productData.shopId,
Â  Â  color: selectedColor
Â  });
Â  saveSelectedOptions();
Â  showMessage(`â¤ï¸ Ğ¢Ğ¾Ğ²Ğ°Ñ€ Ğ´Ğ¾Ğ±Ğ°Ğ²Ğ»ĞµĞ½ Ğ² Ğ¸Ğ·Ğ±Ñ€Ğ°Ğ½Ğ½Ğ¾Ğµ`, false);
});

// ==========================
// Ğ¡Ğ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ñ
// ==========================
function showMessage(text,isError){
Â  const msgBox=document.getElementById("message-box");
Â  msgBox.innerHTML=text;
Â  msgBox.className="show";
Â  msgBox.style.backgroundColor=isError?"#ef4444":"#10b981";
Â  setTimeout(()=>msgBox.classList.remove("show"),5000);
}

window.onload=initializeAuthAndFirestore;
</script>
</body>
</html>