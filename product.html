<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Страница товара</title>
<script src="https://cdn.tailwindcss.com"></script>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800;900&display=swap" rel="stylesheet">
<style>
body { font-family: 'Inter', sans-serif; background-color: #fcfcfc; min-height: 100vh; }
.header-bg { background-color: #ffffff; box-shadow: 0 1px 3px rgba(0,0,0,0.05);}
.orange-accent { background-color: #f97316; color:white; font-weight:700; transition:0.3s; }
.orange-accent:hover { background-color: #ea580c; }
.option-button-style { border:2px solid #f97316; background:#ffedd5; color:#f97316; font-weight:600; transition:0.2s; }
.option-button-style.active { background:#f97316; color:white; box-shadow:0 2px 5px rgba(249,115,22,0.3);}
.thumbnail { width:60px; height:60px; border:2px solid transparent; cursor:pointer; border-radius:0.5rem; transition:0.2s; }
.thumbnail.active { border-color:#f97316; box-shadow:0 2px 5px rgba(249,115,22,0.3);}
</style>
</head>
<body class="pb-20">

<header class="sticky top-0 header-bg z-20">
  <div class="max-w-6xl mx-auto px-4 py-4 flex justify-between items-center">
    <a href="index.html" class="text-3xl font-black text-gray-900 tracking-tight">Mebel.by</a>
  </div>
</header>

<main class="max-w-6xl mx-auto px-4 mt-6">

  <div class="mb-6 text-sm text-gray-500">
    <a href="index.html" class="hover:text-orange-500 transition">Главная</a>
    <span class="mx-2">/</span>
    <span class="hover:text-orange-500 transition" id="breadcrumb-category">Категория</span>
    <span class="mx-2">/</span>
    <span class="text-gray-900 font-medium" id="breadcrumb-title">Товар</span>
  </div>

  <div class="lg:grid lg:grid-cols-2 lg:gap-10">

    <!-- Галерея -->
    <div class="mb-8 lg:mb-0">
      <div id="thumbnail-gallery" class="flex gap-3 mb-3"></div>
      <img id="main-product-image" src="https://placehold.co/400x400?text=No+Image" class="w-full rounded-3xl mb-3">
    </div>

    <!-- Информация о товаре -->
    <div class="p-6 bg-white rounded-3xl shadow-2xl">
      <h1 class="text-4xl font-black text-gray-900 mb-2" id="product-title">Товар</h1>
      <p class="text-lg font-medium text-orange-600 uppercase mb-4" id="product-category">Категория</p>

      <div class="mb-5">
        <span id="old-price" class="line-through text-gray-400 mr-3">0 BYN</span>
        <span id="new-price" class="text-3xl font-black text-orange-600">0 BYN</span>
      </div>

      <div class="mb-5">
        <p class="font-bold text-gray-800 mb-3">Фасад:</p>
        <div class="flex flex-wrap gap-3" id="facade-options"></div>
      </div>

      <div class="mb-5">
        <p class="font-bold text-gray-800 mb-3">Материал:</p>
        <div class="flex flex-wrap gap-3" id="material-options"></div>
      </div>

      <div class="mb-8">
        <p class="font-bold text-gray-800 mb-3">Цвет/Текстура:</p>
        <div class="flex flex-wrap gap-3" id="color-options"></div>
      </div>

      <div class="flex flex-col space-y-4">
        <button id="buy-button" class="orange-accent text-white font-black text-lg py-4 rounded-xl uppercase">
          Купить
        </button>
      </div>
    </div>

  </div>
</main>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
import { getFirestore, doc, getDoc } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

const firebaseConfig = {
    apiKey: "AIzaSyA-LeQHKV4NfJrTKQCGjG-VQGhfWxtPk70",
    authDomain: "vsemmebel-90d48.firebaseapp.com",
    projectId: "vsemmebel-90d48",
    storageBucket: "vsemmebel-90d48.firebasestorage.app",
    messagingSenderId: "958123504041",
    appId: "1:958123504041:web:1f14f4561d6bb6628494b8"
};
const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

const urlParams = new URLSearchParams(window.location.search);
const productId = urlParams.get("id");

if(!productId){ alert("Не указан ID товара!"); }
else { loadProduct(productId); }

let productData = null;
let selectedMaterial = null;
let selectedFacade = null;
let selectedColor = null;

async function loadProduct(id){
    const docRef = doc(db, "offers", id);
    const docSnap = await getDoc(docRef);
    if(!docSnap.exists()){ alert("Товар не найден!"); return; }

    productData = docSnap.data();

    document.getElementById("product-title").textContent = productData.title||"Без названия";
    document.getElementById("breadcrumb-title").textContent = productData.title||"Без названия";
    document.getElementById("breadcrumb-category").textContent = productData.category||"-";

    // Галерея
    const gallery = document.getElementById("thumbnail-gallery");
    gallery.innerHTML="";
    const images = productData.images || [productData.image];
    images.forEach((img,i)=>{
        const thumb = document.createElement("img");
        thumb.src=img;
        thumb.className="thumbnail"+(i===0?" active":"");
        thumb.onclick=()=>{
            document.getElementById("main-product-image").src=img;
            gallery.querySelectorAll("img").forEach(t=>t.classList.remove("active"));
            thumb.classList.add("active");
        };
        gallery.appendChild(thumb);
    });
    document.getElementById("main-product-image").src=images[0];

    // Фасады
    const facadeContainer = document.getElementById("facade-options");
    facadeContainer.innerHTML="";
    (productData.facades||[]).forEach(f=>{
        const btn = document.createElement("button");
        btn.textContent=f;
        btn.className="option-button-style";
        btn.onclick=()=>{
            selectedFacade=f; updateSelection(); updatePrice();
            facadeContainer.querySelectorAll("button").forEach(b=>b.classList.remove("active"));
            btn.classList.add("active");
        };
        facadeContainer.appendChild(btn);
    });

    // Материалы
    const materialContainer = document.getElementById("material-options");
    materialContainer.innerHTML="";
    (productData.materials||[]).forEach(m=>{
        const btn = document.createElement("button");
        btn.textContent=m;
        btn.className="option-button-style";
        btn.onclick=()=>{
            selectedMaterial=m; updateSelection(); updatePrice();
            materialContainer.querySelectorAll("button").forEach(b=>b.classList.remove("active"));
            btn.classList.add("active");
        };
        materialContainer.appendChild(btn);
    });

    // Цвета
    const colorContainer = document.getElementById("color-options");
    colorContainer.innerHTML="";
    (productData.colors||[]).forEach(c=>{
        const btn=document.createElement("button");
        btn.textContent=c.name;
        btn.className="option-button-style";
        btn.style.background=c.hex||'#fff';
        btn.onclick=()=>{
            selectedColor=c.name; updateSelection(); updatePrice();
            colorContainer.querySelectorAll("button").forEach(b=>b.classList.remove("active"));
            btn.classList.add("active");
            if(c.image) document.getElementById("main-product-image").src=c.image;
        };
        colorContainer.appendChild(btn);
    });

    // --- Выбираем первую доступную комбинацию ---
    if(productData.combinations && productData.combinations.length){
        const combo = productData.combinations[0];
        selectedMaterial = combo.material;
        selectedFacade = combo.facade;
        selectedColor = combo.color;
        // активируем кнопки
        activateOption('material-options', selectedMaterial);
        activateOption('facade-options', selectedFacade);
        activateOption('color-options', selectedColor);
        if(combo.colorImage) document.getElementById("main-product-image").src = combo.colorImage;
    } else {
        // выбираем первый доступный вариант, если комбинаций нет
        selectedMaterial = productData.materials?.[0]||null;
        selectedFacade = productData.facades?.[0]||null;
        selectedColor = productData.colors?.[0]?.name||null;
        if(productData.colors?.[0]?.image) document.getElementById("main-product-image").src = productData.colors[0].image;
        activateOption('material-options', selectedMaterial);
        activateOption('facade-options', selectedFacade);
        activateOption('color-options', selectedColor);
    }

    updatePrice();
}

function activateOption(containerId, value){
    if(!value) return;
    const container = document.getElementById(containerId);
    container.querySelectorAll('button').forEach(b=>{
        if(b.textContent===value) b.classList.add('active');
    });
}

function updateSelection(){
    // можно показывать выбранные параметры где-то
}

function updatePrice(){
    const oldPriceEl = document.getElementById("old-price");
    const newPriceEl = document.getElementById("new-price");

    let basePrice = productData.price || 1000;
    let discount = productData.discount || 0;

    if(productData.combinations && selectedMaterial && selectedFacade && selectedColor){
        const combo = productData.combinations.find(c=>c.material===selectedMaterial && c.facade===selectedFacade && c.color===selectedColor);
        if(combo && combo.price) basePrice=combo.price;
    }

    oldPriceEl.textContent=formatPrice(basePrice);
    newPriceEl.textContent=formatPrice(Math.round(basePrice*(1-discount/100)));
}

function formatPrice(price){
    return price.toLocaleString('ru-RU',{style:'currency', currency:'BYN', maximumFractionDigits:0});
}

document.getElementById("buy-button").onclick=()=>{
    alert(`Вы купили: ${productData.title}\nМатериал: ${selectedMaterial||'-'}\nФасад: ${selectedFacade||'-'}\nЦвет: ${selectedColor||'-'}`);
};
</script>

</body>
</html>
